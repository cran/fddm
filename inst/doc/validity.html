<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Kendal Foster and Henrik Singmann" />

<meta name="date" content="2020-07-08" />

<title>Validity of Methods</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {background-color: #ffffff;max-width: 800px;margin-left: auto;margin-right: auto;margin-top: 0px;margin-bottom: 0px;padding-left: 5%;padding-right: 4%;padding-top: 10px;padding-bottom: 30px;overflow: visible;font-family: Verdana;font-size: 14px;line-height: 1.35;}#TOC {clear: both;margin: 0 0 10px 10px;padding: 4px;width: 400px;border: 1px solid #CCCCCC;border-radius: 5px;background-color: #f6f6f6;font-size: 13px;line-height: 1.3;}#TOC .toctitle {font-weight: bold;font-size: 15px;margin-left: 5px;}#TOC ul {padding-left: 40px;margin-left: -1.5em;margin-top: 5px;margin-bottom: 5px;}#TOC ul ul {margin-left: -2em;}#TOC li {line-height: 16px;}table {margin: 1em auto;border-width: 1px;border-color: #DDDDDD;border-style: outset;border-collapse: collapse;}table th {border-width: 2px;padding: 5px;border-style: inset;}table td {border-width: 1px;border-style: inset;line-height: 18px;padding: 5px 5px;}table, table th, table td {border-left-style: none;border-right-style: none;}table thead, table tr.even {background-color: #f7f7f7;}p {margin: 0.5em 0;}p.method { background-color: #fcfcfc;margin-left: 2em;margin-right: 2em;border-style: double;border-width: 4px;border-color: #b3fffa;border-radius: 5px;padding: 0.25em 0.75em 0.25em 1em;}span.math {font-size: 1em;}span.eqref{font-size: 0.75em;}blockquote {background-color: #f6f6f6;padding: 0.25em 0.75em;}hr {border-style: solid;border: none;border-top: 1px solid #777;margin: 28px 0;}hr.sec1 {margin-top: -1.5em;border-width: 2px;border-color: #aaaaaa;}dl {margin-left: 0;}dl dd {margin-bottom: 13px;margin-left: 13px;}dl dt {font-weight: bold;}ul {margin-top: 0;}ul li {list-style: circle outside;}ul ul {margin-bottom: 0;}pre, code {background-color: #f0f0f0;border-radius: 3px;color: #333;white-space: pre-wrap; }pre {border-radius: 3px;margin: 5px 0px 10px 0px;padding: 10px;}pre:not([class]) {background-color: #f7f7f7;}code {font-family: Consolas, Monaco, 'Courier New', monospace;font-size: 95%;}p > code, li > code {padding: 2px 0px;}div.indent2 {margin-left: 2%;}div.indent3 {margin-left: 3%;}div.figure {text-align: center;}img {background-color: #FFFFFF;padding: 2px;border: 1px solid #DDDDDD;border-radius: 3px;border: 1px solid #CCCCCC;margin: 0 5px;}h1 {margin-top: 0;font-size: 175%;line-height: 40px;}h2 {border-bottom: 4px solid #dbdbdb;padding-top: 10px;padding-bottom: 2px;font-size: 145%;}h3 {border-bottom: 2px solid #e8e8e8;padding-top: 10px;font-size: 120%;}h4 {border-bottom: 1px solid #f7f7f7;margin-left: 8px;font-size: 105%;}h5, h6 {border-bottom: 1px solid #ccc;font-size: 105%;}a {color: #0033dd;text-decoration: none;}a:hover {color: #6666ff; }a:visited {color: #800080; }a:visited:hover {color: #BB00BB; }a[href^="http:"] {text-decoration: underline; }a[href^="https:"] {text-decoration: underline; }code > span.kw { color: #555; font-weight: bold; } code > span.dt { color: #902000; } code > span.dv { color: #40a070; } code > span.bn { color: #d14; } code > span.fl { color: #d14; } code > span.ch { color: #d14; } code > span.st { color: #d14; } code > span.co { color: #888888; font-style: italic; } code > span.ot { color: #007020; } code > span.al { color: #ff0000; font-weight: bold; } code > span.fu { color: #900; font-weight: bold; } code > span.er { color: #a61717; background-color: #e3d2d2; } </style>




</head>

<body>




<h1 class="title toc-ignore">Validity of Methods</h1>
<h4 class="author">Kendal Foster and Henrik Singmann</h4>
<h4 class="date">July 08, 2020</h4>



<div id="TOC">
<ul>
<li>
<a href="#background">Background</a>
</li>
<li>
<a href="#den">Validating the Density Functions</a>
<ul>
<li>
<a href="#den-gen">Generating Data</a>
</li>
<li>
<a href="#den-test">Testing the Density Functions</a>
</li>
<li>
<a href="#den-ke">Known Errors</a>
</li>
</ul>
</li>
<li>
<a href="#fit">Validating Fitting Using the Density Functions</a>
<ul>
<li>
<a href="#fit-gen">Generating Parameter Estimates</a>
</li>
<li>
<a href="#fit-test">Testing the Parameter Estimates</a>
</li>
<li>
<a href="#fit-ke">Known Errors</a>
</li>
</ul>
</li>
<li>
<a href="#references">References</a>
</li>
</ul>
</div>
<p>Function <code>dfddm</code> evaluates the density function (or probability density function, PDF) for the Ratcliff diffusion decision model (DDM) using different methods for approximating the full PDF, which contains an infinite sum. An overview of the mathematical details of the different approximations is provided in the <a href="math.html">Math Vignette</a>. Timing benchmarks for the present methods and comparison with existing methods are provided in the <a href="benchmark.html">Benchmark Vignette</a>. Two examples of using <code>dfddm</code> for parameter estimation are provided in the <a href="example.html">Example Vignette</a>.</p>
<p>Our implementation of the DDM has the following parameters: <span class="math inline">\(a \in (0, \infty)\)</span> (threshold separation), <span class="math inline">\(v \in (-\infty, \infty)\)</span> (drift rate), <span class="math inline">\(t_0 \in [0, \infty)\)</span> (non-decision time/response time constant), <span class="math inline">\(w \in (0, 1)\)</span> (relative starting point), and <span class="math inline">\(sv \in (0, \infty)\)</span> (inter-trial-variability of drift). <br><br></p>
<div id="background" class="section level1">
<h1>Background</h1>
<hr class="sec1">
<p>This vignette is more technical in nature and will demonstrate not only the consistency across the different implemented methods but also show that <code>dfddm</code> is in accordance with other implementations in the literature. In addition to testing all of the methods available in <code>dfddm</code>, we also include three functions that are considered to be current and widely used. First, we include the function <code>ddiffusion</code> from the package <a href="https://cran.r-project.org/package=rtdists"><code>rtdists</code></a> as it is well known for being not only user friendly and feature-rich but also designed specifically for handling data with regard to distributions for response time models. Second, we also test the <code>dwiener</code> function from the <a href="https://cran.r-project.org/package=RWiener"><code>RWiener</code></a> package, which is mainly aimed at providing an <code>R</code> language interface to calculate various functions from the Wiener process. Third, we include some raw <code>R</code> code that is bundled with the paper written by <span class="citation">Gondan, Blurton, and Kesselmeier (2014)</span> about improving the approximation to the density function. As this code was not yet available in an <code>R</code> package, it is part of <code>fddm</code> and can be accessed after running <code>source</code> on the corresponding file <a href="#gon-r-code">as shown below</a>.</p>
<p>First, we perform a simple test in <a href="#den">Validating the Density Functions</a>, evaluating each algorithm for the density function of the DDM and comparing their consistency. To ensure rigorous concordance across all algorithms, we test each algorithm throughout a sufficiently large and granular parameter space that can be found fully defined in the subsection <a href="#den-gen">Generating Data</a>. Of course these algorithms are approximations, and as such they will provide slightly different results given the same parameter inputs. To ensure that these small differences in density output do not affect the results of fitting parameters to real-world data, we also include testing in an optimization setting in <a href="#fit">Validating Fitting (Optimization) Using the Density Functions</a>. We use the various algorithms as the bases for log-likelihood functions for the optimization process and include a variety of starting points in the parameter space to ensure rigorous consistency testing.</p>
</div>
<div id="den" class="section level1">
<h1>Validating the Density Functions</h1>
<hr class="sec1">
<p><a id="expl-dens-test"></a> It is imperative to show that our density functions produce the same results as the current standards. To demonstrate this, we calculate the lower probability density for a granular parameter space and show that all of the results are within an acceptable error tolerance. We only calculate the lower probability density because the upper probability density negates <span class="math inline">\(v\)</span> (<span class="math inline">\(v&#39; = -v\)</span>) and takes the complement of <span class="math inline">\(w\)</span> (<span class="math inline">\(w&#39; = 1-w\)</span>); our parameter space already includes all of these values so calculating the upper probability density would be redundant. The fully defined parameter space can be <a href="#par-space">found below</a>, and it includes both realistically feasible values and some extreme values for each parameter. Since each of these functions approximates an infinite summation to a desired precision of <span class="math inline">\(\epsilon\)</span>, we allow for a difference of <span class="math inline">\(2 \cdot \epsilon\)</span> between any pair of calculated densities to account for convergence from above and below the limit of the summation.</p>
<p>Note that we include <span class="math inline">\(sv\)</span> in all the functions tested below, even those that do not contain <span class="math inline">\(sv\)</span> themselves (i.e., <code>RWiener</code> and <span class="citation">Gondan, Blurton, and Kesselmeier (2014)</span>). This is possible because variability in drift rate can be added to those functions via the constant <span class="math inline">\(M\)</span> as described in the <a href="math.html#mathematical-background">Math Vignette</a>.</p>
<div id="den-gen" class="section level2">
<h2>Generating Data</h2>
<p>First we load the necessary packages and code available from the current literature.</p>
<p><a id="gon-r-code"></a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(<span class="st">&quot;fddm&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(<span class="st">&quot;rtdists&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(<span class="st">&quot;RWiener&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">source</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;Gondan_et_al_density.R&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;fddm&quot;</span>, <span class="dt">mustWork =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p>The following code chunk stores the lower probability densities calculated across the parameter space using the different methods; we also calculate and store the log-probability for consistency testing.</p>
<p><a id="par-space"></a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Define parameter space</span></a>
<a class="sourceLine" id="cb2-2" title="2">RT &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">A &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-4" title="4">V &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">t0 &lt;-<span class="st"> </span><span class="fl">1e-4</span> <span class="co"># must be nonzero for RWiener</span></a>
<a class="sourceLine" id="cb2-6" title="6">W &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb2-7" title="7">SV &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb2-8" title="8">SV_THRESH &lt;-<span class="st"> </span><span class="fl">1e-6</span></a>
<a class="sourceLine" id="cb2-9" title="9">eps &lt;-<span class="st"> </span><span class="fl">1e-6</span> <span class="co"># this is the setting from rtdists</span></a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">nRT &lt;-<span class="st"> </span><span class="kw">length</span>(RT)</a>
<a class="sourceLine" id="cb2-12" title="12">nA &lt;-<span class="st"> </span><span class="kw">length</span>(A)</a>
<a class="sourceLine" id="cb2-13" title="13">nV &lt;-<span class="st"> </span><span class="kw">length</span>(V)</a>
<a class="sourceLine" id="cb2-14" title="14">nW &lt;-<span class="st"> </span><span class="kw">length</span>(W)</a>
<a class="sourceLine" id="cb2-15" title="15">nSV &lt;-<span class="st"> </span><span class="kw">length</span>(SV)</a>
<a class="sourceLine" id="cb2-16" title="16">resp &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;lower&quot;</span>, nRT) <span class="co"># for RWiener</span></a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18">fnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fs_SWSE_17&quot;</span>, <span class="st">&quot;fs_SWSE_14&quot;</span>,</a>
<a class="sourceLine" id="cb2-19" title="19">            <span class="st">&quot;fs_Gon_17&quot;</span>, <span class="st">&quot;fs_Gon_14&quot;</span>, <span class="st">&quot;fs_Nav_17&quot;</span>, <span class="st">&quot;fs_Nav_14&quot;</span>,</a>
<a class="sourceLine" id="cb2-20" title="20">            <span class="st">&quot;fb_Gon_17&quot;</span>, <span class="st">&quot;fb_Gon_14&quot;</span>, <span class="st">&quot;fb_Nav_17&quot;</span>, <span class="st">&quot;fb_Nav_14&quot;</span>,</a>
<a class="sourceLine" id="cb2-21" title="21">            <span class="st">&quot;fl_Nav_09&quot;</span>, <span class="st">&quot;RWiener&quot;</span>, <span class="st">&quot;Gondan&quot;</span>, <span class="st">&quot;rtdists&quot;</span>)</a>
<a class="sourceLine" id="cb2-22" title="22">nf &lt;-<span class="st"> </span><span class="kw">length</span>(fnames)</a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24">res &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">9</span>, <span class="dt">nrow =</span> nf<span class="op">*</span>nRT<span class="op">*</span>nA<span class="op">*</span>nV<span class="op">*</span>nW<span class="op">*</span>nSV))</a>
<a class="sourceLine" id="cb2-25" title="25"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;rt&#39;</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;v&#39;</span>, <span class="st">&#39;w&#39;</span>, <span class="st">&#39;sv&#39;</span>, <span class="st">&#39;FuncName&#39;</span>, <span class="st">&#39;res&#39;</span>, <span class="st">&#39;dif&#39;</span>,</a>
<a class="sourceLine" id="cb2-26" title="26">                   <span class="st">&#39;log_res&#39;</span>)</a>
<a class="sourceLine" id="cb2-27" title="27">start &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2-28" title="28">stop &lt;-<span class="st"> </span>nf</a>
<a class="sourceLine" id="cb2-29" title="29"></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co"># Loop through each combination of parameters and record results</span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="cf">for</span> (rt <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nRT) {</a>
<a class="sourceLine" id="cb2-32" title="32">  <span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nA) {</a>
<a class="sourceLine" id="cb2-33" title="33">    <span class="cf">for</span> (v <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nV) {</a>
<a class="sourceLine" id="cb2-34" title="34">      <span class="cf">for</span> (w <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nW) {</a>
<a class="sourceLine" id="cb2-35" title="35">        <span class="cf">for</span> (sv <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nSV) {</a>
<a class="sourceLine" id="cb2-36" title="36">          <span class="co"># add the rt, v, a, w, and function names to the dataframe</span></a>
<a class="sourceLine" id="cb2-37" title="37">          res[start<span class="op">:</span>stop, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">rep</span>(RT[rt], nf)</a>
<a class="sourceLine" id="cb2-38" title="38">          res[start<span class="op">:</span>stop, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">rep</span>(A[a]  , nf)</a>
<a class="sourceLine" id="cb2-39" title="39">          res[start<span class="op">:</span>stop, <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">rep</span>(V[v]  , nf)</a>
<a class="sourceLine" id="cb2-40" title="40">          res[start<span class="op">:</span>stop, <span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">rep</span>(W[w]  , nf)</a>
<a class="sourceLine" id="cb2-41" title="41">          res[start<span class="op">:</span>stop, <span class="dv">5</span>] &lt;-<span class="st"> </span><span class="kw">rep</span>(SV[sv], nf)</a>
<a class="sourceLine" id="cb2-42" title="42">          res[start<span class="op">:</span>stop, <span class="dv">6</span>] &lt;-<span class="st"> </span>fnames</a>
<a class="sourceLine" id="cb2-43" title="43"></a>
<a class="sourceLine" id="cb2-44" title="44">          <span class="co"># calculate &quot;lower&quot; density</span></a>
<a class="sourceLine" id="cb2-45" title="45">          res[start,    <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-46" title="46">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-47" title="47">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;SWSE&quot;</span>,</a>
<a class="sourceLine" id="cb2-48" title="48">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-49" title="49">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-50" title="50">          res[start<span class="op">+</span><span class="dv">1</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-51" title="51">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-52" title="52">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;SWSE&quot;</span>,</a>
<a class="sourceLine" id="cb2-53" title="53">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-54" title="54">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-55" title="55">          res[start<span class="op">+</span><span class="dv">2</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-56" title="56">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-57" title="57">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>,</a>
<a class="sourceLine" id="cb2-58" title="58">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-59" title="59">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-60" title="60">          res[start<span class="op">+</span><span class="dv">3</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-61" title="61">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-62" title="62">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>,</a>
<a class="sourceLine" id="cb2-63" title="63">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-64" title="64">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-65" title="65">          res[start<span class="op">+</span><span class="dv">4</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-66" title="66">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-67" title="67">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>,</a>
<a class="sourceLine" id="cb2-68" title="68">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-69" title="69">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-70" title="70">          res[start<span class="op">+</span><span class="dv">5</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-71" title="71">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-72" title="72">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>,</a>
<a class="sourceLine" id="cb2-73" title="73">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-74" title="74">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-75" title="75">          res[start<span class="op">+</span><span class="dv">6</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-76" title="76">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-77" title="77">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>,</a>
<a class="sourceLine" id="cb2-78" title="78">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb2-79" title="79">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-80" title="80">          res[start<span class="op">+</span><span class="dv">7</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-81" title="81">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-82" title="82">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>,</a>
<a class="sourceLine" id="cb2-83" title="83">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb2-84" title="84">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-85" title="85">          res[start<span class="op">+</span><span class="dv">8</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-86" title="86">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-87" title="87">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>,</a>
<a class="sourceLine" id="cb2-88" title="88">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb2-89" title="89">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-90" title="90">          res[start<span class="op">+</span><span class="dv">9</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-91" title="91">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-92" title="92">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>,</a>
<a class="sourceLine" id="cb2-93" title="93">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb2-94" title="94">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-95" title="95">          res[start<span class="op">+</span><span class="dv">10</span>,  <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-96" title="96">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-97" title="97">                                    <span class="dt">log =</span> <span class="ot">FALSE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb2-98" title="98">                                    <span class="dt">summation_small =</span> <span class="st">&quot;&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;large&quot;</span>,</a>
<a class="sourceLine" id="cb2-99" title="99">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-100" title="100">          res[start<span class="op">+</span><span class="dv">11</span>, <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">dwiener</span>(RT[rt], <span class="dt">resp =</span> resp[rt], <span class="dt">alpha =</span> A[a],</a>
<a class="sourceLine" id="cb2-101" title="101">                                      <span class="dt">delta =</span> V[v], <span class="dt">tau =</span> t0, <span class="dt">beta =</span> W[w],</a>
<a class="sourceLine" id="cb2-102" title="102">                                      <span class="dt">give_log =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-103" title="103">          res[start<span class="op">+</span><span class="dv">12</span>, <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">fs</span>(<span class="dt">t =</span> RT[rt]<span class="op">-</span>t0, <span class="dt">a =</span> A[a], <span class="dt">v =</span> V[v],</a>
<a class="sourceLine" id="cb2-104" title="104">                                 <span class="dt">w =</span> W[w], <span class="dt">eps =</span> eps)</a>
<a class="sourceLine" id="cb2-105" title="105">          res[start<span class="op">+</span><span class="dv">13</span>, <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">ddiffusion</span>(RT[rt], resp[rt], <span class="dt">a =</span> A[a], <span class="dt">v =</span> V[v],</a>
<a class="sourceLine" id="cb2-106" title="106">                                        <span class="dt">t0 =</span> t0, <span class="dt">z =</span> W[w]<span class="op">*</span>A[a], <span class="dt">sv =</span> SV[sv])</a>
<a class="sourceLine" id="cb2-107" title="107">          <span class="cf">if</span> (sv <span class="op">&gt;</span><span class="st"> </span>SV_THRESH) { <span class="co"># multiply to get density with sv</span></a>
<a class="sourceLine" id="cb2-108" title="108">            t &lt;-<span class="st"> </span>RT[rt] <span class="op">-</span><span class="st"> </span>t0</a>
<a class="sourceLine" id="cb2-109" title="109">            M &lt;-<span class="st"> </span><span class="kw">exp</span>(V[v] <span class="op">*</span><span class="st"> </span>A[a] <span class="op">*</span><span class="st"> </span>W[w] <span class="op">+</span><span class="st"> </span>V[v]<span class="op">*</span>V[v] <span class="op">*</span><span class="st"> </span>t <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb2-110" title="110"><span class="st">                     </span>(SV[sv]<span class="op">*</span>SV[sv] <span class="op">*</span><span class="st"> </span>A[a]<span class="op">*</span>A[a] <span class="op">*</span><span class="st"> </span>W[w]<span class="op">*</span>W[w] <span class="op">-</span></a>
<a class="sourceLine" id="cb2-111" title="111"><span class="st">                       </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>V[v] <span class="op">*</span><span class="st"> </span>A[a] <span class="op">*</span><span class="st"> </span>W[w] <span class="op">-</span><span class="st"> </span>V[v]<span class="op">*</span>V[v] <span class="op">*</span><span class="st"> </span>t) <span class="op">/</span></a>
<a class="sourceLine" id="cb2-112" title="112"><span class="st">                     </span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>SV[sv]<span class="op">*</span>SV[sv] <span class="op">*</span><span class="st"> </span>t)) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>SV[sv]<span class="op">*</span>SV[sv] <span class="op">*</span><span class="st"> </span>t)</a>
<a class="sourceLine" id="cb2-113" title="113">            res[start<span class="op">+</span><span class="dv">11</span>, <span class="dv">7</span>] &lt;-<span class="st"> </span>M <span class="op">*</span><span class="st"> </span>res[start<span class="op">+</span><span class="dv">11</span>, <span class="dv">7</span>] <span class="co"># RWiener</span></a>
<a class="sourceLine" id="cb2-114" title="114">            res[start<span class="op">+</span><span class="dv">12</span>, <span class="dv">7</span>] &lt;-<span class="st"> </span>M <span class="op">*</span><span class="st"> </span>res[start<span class="op">+</span><span class="dv">12</span>, <span class="dv">7</span>] <span class="co"># Gondan_R</span></a>
<a class="sourceLine" id="cb2-115" title="115">          }</a>
<a class="sourceLine" id="cb2-116" title="116"></a>
<a class="sourceLine" id="cb2-117" title="117">          <span class="co"># calculate differences</span></a>
<a class="sourceLine" id="cb2-118" title="118">          ans &lt;-<span class="st"> </span>res[start, <span class="dv">7</span>] <span class="co"># use Foster_2017_small as truth</span></a>
<a class="sourceLine" id="cb2-119" title="119">          res[start,    <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start,    <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-120" title="120">          res[start<span class="op">+</span><span class="dv">1</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">1</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-121" title="121">          res[start<span class="op">+</span><span class="dv">2</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">2</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-122" title="122">          res[start<span class="op">+</span><span class="dv">3</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">3</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-123" title="123">          res[start<span class="op">+</span><span class="dv">4</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">4</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-124" title="124">          res[start<span class="op">+</span><span class="dv">5</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">1</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-125" title="125">          res[start<span class="op">+</span><span class="dv">6</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">6</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-126" title="126">          res[start<span class="op">+</span><span class="dv">7</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">7</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-127" title="127">          res[start<span class="op">+</span><span class="dv">8</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">8</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-128" title="128">          res[start<span class="op">+</span><span class="dv">9</span>,  <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">9</span>,  <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-129" title="129">          res[start<span class="op">+</span><span class="dv">10</span>, <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">10</span>, <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-130" title="130">          res[start<span class="op">+</span><span class="dv">11</span>, <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">11</span>, <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-131" title="131">          res[start<span class="op">+</span><span class="dv">12</span>, <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">12</span>, <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-132" title="132">          res[start<span class="op">+</span><span class="dv">13</span>, <span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">abs</span>(res[start<span class="op">+</span><span class="dv">13</span>, <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span>ans)</a>
<a class="sourceLine" id="cb2-133" title="133"></a>
<a class="sourceLine" id="cb2-134" title="134">          <span class="co"># calculate log of &quot;lower&quot; density</span></a>
<a class="sourceLine" id="cb2-135" title="135">          res[start,    <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-136" title="136">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-137" title="137">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;SWSE&quot;</span>,</a>
<a class="sourceLine" id="cb2-138" title="138">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-139" title="139">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-140" title="140">          res[start<span class="op">+</span><span class="dv">1</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-141" title="141">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-142" title="142">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;SWSE&quot;</span>,</a>
<a class="sourceLine" id="cb2-143" title="143">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-144" title="144">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-145" title="145">          res[start<span class="op">+</span><span class="dv">2</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-146" title="146">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-147" title="147">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>,</a>
<a class="sourceLine" id="cb2-148" title="148">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-149" title="149">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-150" title="150">          res[start<span class="op">+</span><span class="dv">3</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-151" title="151">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-152" title="152">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>,</a>
<a class="sourceLine" id="cb2-153" title="153">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-154" title="154">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-155" title="155">          res[start<span class="op">+</span><span class="dv">4</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-156" title="156">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-157" title="157">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>,</a>
<a class="sourceLine" id="cb2-158" title="158">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-159" title="159">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-160" title="160">          res[start<span class="op">+</span><span class="dv">5</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-161" title="161">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-162" title="162">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>,</a>
<a class="sourceLine" id="cb2-163" title="163">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>,</a>
<a class="sourceLine" id="cb2-164" title="164">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-165" title="165">          res[start<span class="op">+</span><span class="dv">6</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-166" title="166">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-167" title="167">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>,</a>
<a class="sourceLine" id="cb2-168" title="168">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb2-169" title="169">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-170" title="170">          res[start<span class="op">+</span><span class="dv">7</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-171" title="171">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-172" title="172">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>,</a>
<a class="sourceLine" id="cb2-173" title="173">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb2-174" title="174">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-175" title="175">          res[start<span class="op">+</span><span class="dv">8</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-176" title="176">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-177" title="177">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>,</a>
<a class="sourceLine" id="cb2-178" title="178">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb2-179" title="179">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-180" title="180">          res[start<span class="op">+</span><span class="dv">9</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-181" title="181">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-182" title="182">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>,</a>
<a class="sourceLine" id="cb2-183" title="183">                                    <span class="dt">summation_small =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb2-184" title="184">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-185" title="185">          res[start<span class="op">+</span><span class="dv">10</span>,  <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> RT[rt], <span class="dt">response =</span> resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-186" title="186">                                    <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">w =</span> W[w], <span class="dt">sv =</span> SV[sv],</a>
<a class="sourceLine" id="cb2-187" title="187">                                    <span class="dt">log =</span> <span class="ot">TRUE</span>, <span class="dt">n_terms_small =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb2-188" title="188">                                    <span class="dt">summation_small =</span> <span class="st">&quot;&quot;</span>, <span class="dt">scale =</span> <span class="st">&quot;large&quot;</span>,</a>
<a class="sourceLine" id="cb2-189" title="189">                                    <span class="dt">err_tol =</span> eps)</a>
<a class="sourceLine" id="cb2-190" title="190">          res[start<span class="op">+</span><span class="dv">11</span>, <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">dwiener</span>(RT[rt], <span class="dt">resp =</span> resp[rt], <span class="dt">alpha =</span> A[a],</a>
<a class="sourceLine" id="cb2-191" title="191">                                      <span class="dt">delta =</span> V[v], <span class="dt">tau =</span> t0, <span class="dt">beta =</span> W[w],</a>
<a class="sourceLine" id="cb2-192" title="192">                                      <span class="dt">give_log =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-193" title="193">          res[start<span class="op">+</span><span class="dv">12</span>, <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="kw">fs</span>(<span class="dt">t =</span> RT[rt]<span class="op">-</span>t0, <span class="dt">a =</span> A[a], <span class="dt">v =</span> V[v],</a>
<a class="sourceLine" id="cb2-194" title="194">                                     <span class="dt">w =</span> W[w], <span class="dt">eps =</span> eps))</a>
<a class="sourceLine" id="cb2-195" title="195">          res[start<span class="op">+</span><span class="dv">13</span>, <span class="dv">9</span>] &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="kw">ddiffusion</span>(RT[rt], resp[rt], <span class="dt">a =</span> A[a],</a>
<a class="sourceLine" id="cb2-196" title="196">                                             <span class="dt">v =</span> V[v], <span class="dt">t0 =</span> t0, <span class="dt">z =</span> W[w]<span class="op">*</span>A[a],</a>
<a class="sourceLine" id="cb2-197" title="197">                                             <span class="dt">sv =</span> SV[sv]))</a>
<a class="sourceLine" id="cb2-198" title="198">          <span class="cf">if</span> (sv <span class="op">&gt;</span><span class="st"> </span>SV_THRESH) { <span class="co"># add to get log of density with sv</span></a>
<a class="sourceLine" id="cb2-199" title="199">            t &lt;-<span class="st"> </span>RT[rt] <span class="op">-</span><span class="st"> </span>t0</a>
<a class="sourceLine" id="cb2-200" title="200">            M &lt;-<span class="st"> </span>V[v] <span class="op">*</span><span class="st"> </span>A[a] <span class="op">*</span><span class="st"> </span>W[w] <span class="op">+</span><span class="st"> </span>V[v]<span class="op">*</span>V[v] <span class="op">*</span><span class="st"> </span>t <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb2-201" title="201"><span class="st">                 </span>(SV[sv]<span class="op">*</span>SV[sv] <span class="op">*</span><span class="st"> </span>A[a]<span class="op">*</span>A[a] <span class="op">*</span><span class="st"> </span>W[w]<span class="op">*</span>W[w] <span class="op">-</span></a>
<a class="sourceLine" id="cb2-202" title="202"><span class="st">                  </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>V[v] <span class="op">*</span><span class="st"> </span>A[a] <span class="op">*</span><span class="st"> </span>W[w] <span class="op">-</span><span class="st"> </span>V[v]<span class="op">*</span>V[v] <span class="op">*</span><span class="st"> </span>t) <span class="op">/</span></a>
<a class="sourceLine" id="cb2-203" title="203"><span class="st">                 </span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>SV[sv]<span class="op">*</span>SV[sv] <span class="op">*</span><span class="st"> </span>t) <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>SV[sv]<span class="op">*</span>SV[sv] <span class="op">*</span><span class="st"> </span>t)</a>
<a class="sourceLine" id="cb2-204" title="204">            res[start<span class="op">+</span><span class="dv">11</span>, <span class="dv">9</span>] &lt;-<span class="st"> </span>M <span class="op">+</span><span class="st"> </span>res[start<span class="op">+</span><span class="dv">11</span>, <span class="dv">9</span>] <span class="co"># RWiener</span></a>
<a class="sourceLine" id="cb2-205" title="205">            res[start<span class="op">+</span><span class="dv">12</span>, <span class="dv">9</span>] &lt;-<span class="st"> </span>M <span class="op">+</span><span class="st"> </span>res[start<span class="op">+</span><span class="dv">12</span>, <span class="dv">9</span>] <span class="co"># Gondan_R</span></a>
<a class="sourceLine" id="cb2-206" title="206">          }</a>
<a class="sourceLine" id="cb2-207" title="207"></a>
<a class="sourceLine" id="cb2-208" title="208">          <span class="co"># iterate start and stop values</span></a>
<a class="sourceLine" id="cb2-209" title="209">          start =<span class="st"> </span>start <span class="op">+</span><span class="st"> </span>nf</a>
<a class="sourceLine" id="cb2-210" title="210">          stop =<span class="st"> </span>stop <span class="op">+</span><span class="st"> </span>nf</a>
<a class="sourceLine" id="cb2-211" title="211">        }</a>
<a class="sourceLine" id="cb2-212" title="212">      }</a>
<a class="sourceLine" id="cb2-213" title="213">    }</a>
<a class="sourceLine" id="cb2-214" title="214">  }</a>
<a class="sourceLine" id="cb2-215" title="215">}</a></code></pre></div>
</div>
<div id="den-test" class="section level2">
<h2>Testing the Density Functions</h2>
<p>Now we test the consistency of the various density function approximations by using the <a href="https://cran.r-project.org/package=testthat"><code>testthat</code></a> package. As <a href="#expl-dens-test">discussed above</a>, we allow the difference between any two outputs to be twice the original desired accuracy to allow for convergence from either above or below. We have to amend some of the checks because of the instability of some of the methods, and these are documented in the <a href="#den-ke">Known Errors</a> section below. First we check that all of the approximations produce densities that are non-negative (we allow a density equal to zero). Next, we check the consistency of the internal <code>dfddm</code> methods before confirming their accuracy with external code from established packages. Lastly, we run similar tests to check the consistency of the logged results; however, we do not test the logs of densities that are very close to zero (i.e., less than <span class="math inline">\(\epsilon^2\)</span>) because even a small difference in approximated density can lead to a very large difference in logged density. If all tests pass correctly, there should be no output.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">library</span>(<span class="st">&quot;testthat&quot;</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co"># Subset results</span></a>
<a class="sourceLine" id="cb3-4" title="4">SWSE &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">%in%</span><span class="st"> </span>fnames[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</a>
<a class="sourceLine" id="cb3-5" title="5">Gondan_s &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">%in%</span><span class="st"> </span>fnames[<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)])</a>
<a class="sourceLine" id="cb3-6" title="6">Gondan_b &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">%in%</span><span class="st"> </span>fnames[<span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">8</span>)])</a>
<a class="sourceLine" id="cb3-7" title="7">Navarro_s &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">%in%</span><span class="st"> </span>fnames[<span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">6</span>)])</a>
<a class="sourceLine" id="cb3-8" title="8">Navarro_l &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">%in%</span><span class="st"> </span>fnames[<span class="dv">11</span>])</a>
<a class="sourceLine" id="cb3-9" title="9">Navarro_b &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">%in%</span><span class="st"> </span>fnames[<span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">10</span>)])</a>
<a class="sourceLine" id="cb3-10" title="10">rtdists &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">==</span><span class="st"> &quot;rtdists&quot;</span>)</a>
<a class="sourceLine" id="cb3-11" title="11">RWiener &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">==</span><span class="st"> &quot;RWiener&quot;</span>)</a>
<a class="sourceLine" id="cb3-12" title="12">Gondan_R &lt;-<span class="st"> </span><span class="kw">subset</span>(res, FuncName <span class="op">==</span><span class="st"> &quot;Gondan&quot;</span>)</a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co"># Compensate for KE 1, 2</span></a>
<a class="sourceLine" id="cb3-15" title="15">Nav_s_res_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">subset</span>(Navarro_s, res <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="co"># KE 1</span></a>
<a class="sourceLine" id="cb3-16" title="16">Nav_s_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">min</span>(Nav_s_res_<span class="dv">0</span><span class="op">$</span>rt <span class="op">/</span><span class="st"> </span>Nav_s_res_<span class="dv">0</span><span class="op">$</span>a <span class="op">/</span><span class="st"> </span>Nav_s_res_<span class="dv">0</span><span class="op">$</span>a) <span class="co"># = 12</span></a>
<a class="sourceLine" id="cb3-17" title="17">Nav_l_res_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">subset</span>(Navarro_l, res <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="co"># KE 2</span></a>
<a class="sourceLine" id="cb3-18" title="18">Nav_l_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">max</span>(Nav_l_res_<span class="dv">0</span><span class="op">$</span>rt <span class="op">/</span><span class="st"> </span>Nav_l_res_<span class="dv">0</span><span class="op">$</span>a <span class="op">/</span><span class="st"> </span>Nav_l_res_<span class="dv">0</span><span class="op">$</span>a) <span class="co"># = 0.04</span></a>
<a class="sourceLine" id="cb3-19" title="19">Nav_l_dif_2eps &lt;-<span class="st"> </span><span class="kw">subset</span>(Navarro_l, dif <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps) <span class="co"># KE 2</span></a>
<a class="sourceLine" id="cb3-20" title="20">Nav_l_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">max</span>(Nav_l_dif_2eps<span class="op">$</span>rt <span class="op">/</span><span class="st"> </span>Nav_l_dif_2eps<span class="op">$</span>a <span class="op">/</span><span class="st"> </span>Nav_l_dif_2eps<span class="op">$</span>a) <span class="co"># = 0.004</span></a>
<a class="sourceLine" id="cb3-21" title="21"></a>
<a class="sourceLine" id="cb3-22" title="22"></a>
<a class="sourceLine" id="cb3-23" title="23"><span class="co"># Ensure all densities are non-negative</span></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="kw">test_that</span>(<span class="st">&quot;Non-negativity of densities&quot;</span>, {</a>
<a class="sourceLine" id="cb3-25" title="25">  <span class="kw">expect_true</span>(<span class="kw">all</span>(SWSE<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb3-26" title="26">  <span class="kw">expect_true</span>(<span class="kw">all</span>(Gondan_s<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb3-27" title="27">  <span class="kw">expect_true</span>(<span class="kw">all</span>(Gondan_b<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb3-28" title="28">  <span class="kw">expect_true</span>(<span class="kw">all</span>(<span class="kw">subset</span>(Navarro_s, rt<span class="op">/</span>a<span class="op">/</span>a <span class="op">&lt;</span><span class="st"> </span>Nav_s_<span class="dv">0</span>)<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>)) <span class="co"># see KE 1</span></a>
<a class="sourceLine" id="cb3-29" title="29">  <span class="kw">expect_true</span>(<span class="kw">all</span>(<span class="kw">subset</span>(Navarro_l, rt<span class="op">/</span>a<span class="op">/</span>a <span class="op">&gt;</span><span class="st"> </span>Nav_l_<span class="dv">0</span>)<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>)) <span class="co"># see KE 2</span></a>
<a class="sourceLine" id="cb3-30" title="30">  <span class="kw">expect_true</span>(<span class="kw">all</span>(<span class="kw">subset</span>(Navarro_b, rt<span class="op">/</span>a<span class="op">/</span>a <span class="op">&gt;</span><span class="st"> </span>Nav_l_<span class="dv">0</span>)<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>)) <span class="co"># see KE 3</span></a>
<a class="sourceLine" id="cb3-31" title="31">  <span class="kw">expect_true</span>(<span class="kw">all</span>(rtdists<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb3-32" title="32">  <span class="kw">expect_true</span>(<span class="kw">all</span>(RWiener<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb3-33" title="33">  <span class="kw">expect_true</span>(<span class="kw">all</span>(Gondan_R<span class="op">$</span>res <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb3-34" title="34">})</a>
<a class="sourceLine" id="cb3-35" title="35"></a>
<a class="sourceLine" id="cb3-36" title="36"><span class="co"># Test accuracy within 2*eps (allows for convergence from above and below)</span></a>
<a class="sourceLine" id="cb3-37" title="37"><span class="kw">test_that</span>(<span class="st">&quot;Consistency among internal methods&quot;</span>, {</a>
<a class="sourceLine" id="cb3-38" title="38">  <span class="kw">expect_true</span>(<span class="kw">all</span>(SWSE<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps))</a>
<a class="sourceLine" id="cb3-39" title="39">  <span class="kw">expect_true</span>(<span class="kw">all</span>(Gondan_s<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps))</a>
<a class="sourceLine" id="cb3-40" title="40">  <span class="kw">expect_true</span>(<span class="kw">all</span>(Gondan_b<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps))</a>
<a class="sourceLine" id="cb3-41" title="41">  <span class="kw">expect_true</span>(<span class="kw">all</span>(Navarro_s<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps)) <span class="co"># see KE 1</span></a>
<a class="sourceLine" id="cb3-42" title="42">  <span class="kw">expect_true</span>(<span class="kw">all</span>(<span class="kw">subset</span>(Navarro_l, rt<span class="op">/</span>a<span class="op">/</span>a <span class="op">&gt;</span><span class="st"> </span>Nav_l_<span class="dv">2</span>)<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps)) <span class="co"># see KE 2</span></a>
<a class="sourceLine" id="cb3-43" title="43">  <span class="kw">expect_true</span>(<span class="kw">all</span>(Navarro_b<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps)) <span class="co"># see KE 1,2</span></a>
<a class="sourceLine" id="cb3-44" title="44">})</a>
<a class="sourceLine" id="cb3-45" title="45"></a>
<a class="sourceLine" id="cb3-46" title="46"><span class="kw">test_that</span>(<span class="st">&quot;Accuracy relative to established packages&quot;</span>, {</a>
<a class="sourceLine" id="cb3-47" title="47">  <span class="kw">expect_true</span>(<span class="kw">all</span>(rtdists<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps))</a>
<a class="sourceLine" id="cb3-48" title="48">  <span class="kw">expect_true</span>(<span class="kw">all</span>(RWiener<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps))</a>
<a class="sourceLine" id="cb3-49" title="49">  <span class="kw">expect_true</span>(<span class="kw">all</span>(<span class="kw">subset</span>(Gondan_R, sv <span class="op">&lt;</span><span class="st"> </span>SV_THRESH)<span class="op">$</span>dif <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>eps)) <span class="co"># see KE 4</span></a>
<a class="sourceLine" id="cb3-50" title="50">})</a>
<a class="sourceLine" id="cb3-51" title="51"></a>
<a class="sourceLine" id="cb3-52" title="52"><span class="co"># Test consistency in log vs non-log</span></a>
<a class="sourceLine" id="cb3-53" title="53"><span class="kw">test_that</span>(<span class="st">&quot;Log-Consistency among internal methods&quot;</span>, {</a>
<a class="sourceLine" id="cb3-54" title="54">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(SWSE, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-55" title="55">               <span class="kw">log</span>(<span class="kw">subset</span>(SWSE, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-56" title="56">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(Gondan_s, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-57" title="57">               <span class="kw">log</span>(<span class="kw">subset</span>(Gondan_s, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-58" title="58">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(Gondan_b, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-59" title="59">               <span class="kw">log</span>(<span class="kw">subset</span>(Gondan_b, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-60" title="60">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(Navarro_s, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-61" title="61">               <span class="kw">log</span>(<span class="kw">subset</span>(Navarro_s, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-62" title="62">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(Navarro_l, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-63" title="63">               <span class="kw">log</span>(<span class="kw">subset</span>(Navarro_l, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-64" title="64">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(Navarro_b, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-65" title="65">               <span class="kw">log</span>(<span class="kw">subset</span>(Navarro_b, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-66" title="66">})</a>
<a class="sourceLine" id="cb3-67" title="67"></a>
<a class="sourceLine" id="cb3-68" title="68"><span class="kw">test_that</span>(<span class="st">&quot;Log-Consistency of established packages&quot;</span>, {</a>
<a class="sourceLine" id="cb3-69" title="69">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(rtdists, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-70" title="70">               <span class="kw">log</span>(<span class="kw">subset</span>(rtdists, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-71" title="71">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(RWiener, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-72" title="72">               <span class="kw">log</span>(<span class="kw">subset</span>(RWiener, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-73" title="73">  <span class="kw">expect_equal</span>(<span class="kw">subset</span>(Gondan_R, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>log_res,</a>
<a class="sourceLine" id="cb3-74" title="74">               <span class="kw">log</span>(<span class="kw">subset</span>(Gondan_R, res <span class="op">&gt;</span><span class="st"> </span>eps<span class="op">*</span>eps)<span class="op">$</span>res))</a>
<a class="sourceLine" id="cb3-75" title="75">})</a></code></pre></div>
</div>
<div id="den-ke" class="section level2">
<h2>Known Errors (KE)</h2>
<ol style="list-style-type: decimal">
<li><p>Navarro small-time approximation is unstable for large effective response times, <span class="math inline">\(\frac{rt}{a^2} \geq 12\)</span>. It gives slightly negative densities for effective response times above this threshold. These parameter values should not have an effect on the both time scale because the large-time approximation should handle such locations in the parameter space. The negative results, however, are still within <span class="math inline">\(2 \cdot \epsilon\)</span> of the accepted results (basically zero).</p></li>
<li><p>Navarro large-time approximation is unstable for small effective response times, <span class="math inline">\(\frac{rt}{a^2} \leq 0.04\)</span>. Similarly to the Navarro small-time approximation above, the large-time approximation gives slightly negative densities for effective response times in this range. Furthermore, it yields inaccurate densities for effective response times of <span class="math inline">\(\frac{rt}{a^2} \leq 0.004\)</span>. These parameter values should not have an effect on the both time scale because the small-time approximation should handle such locations in the parameter space.</p></li>
<li><p>The Navarro both time scale switches between the small-time and large-time approximations. This method relies too much on the unstable large time approximation, leading to its instability; thus we only need to subset to correct for the large time.</p></li>
</ol>
<p><a id="gon-m"></a> 4) The Gondan_R approximation divides the error tolerance by the multiplicative term outside of the summation. Since the outside term is different when <span class="math inline">\(sv &gt; 0\)</span>, the approximation uses the incorrect error tolerance for <span class="math inline">\(sv &gt; 0\)</span>. This affects the number of terms required in the summation to achieve the desired precision, thus not actually achieving that desired precision. This issue is fixed in our implementation of the Gondan method (<code>n_terms_small = &quot;Gondan&quot;</code>, <code>scale = &quot;small&quot;</code>). For an example of this discrepancy, see the following code:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">rt &lt;-<span class="st"> </span><span class="fl">1.5</span></a>
<a class="sourceLine" id="cb4-2" title="2">t &lt;-<span class="st"> </span>rt <span class="op">-</span><span class="st"> </span><span class="fl">1e-4</span></a>
<a class="sourceLine" id="cb4-3" title="3">a &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb4-4" title="4">v &lt;-<span class="st"> </span><span class="fl">4.5</span></a>
<a class="sourceLine" id="cb4-5" title="5">w &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb4-6" title="6">eps &lt;-<span class="st"> </span><span class="fl">1e-6</span></a>
<a class="sourceLine" id="cb4-7" title="7">sv &lt;-<span class="st"> </span><span class="fl">0.9</span></a>
<a class="sourceLine" id="cb4-8" title="8">sv0 &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>v<span class="op">*</span>a<span class="op">*</span>w <span class="op">-</span><span class="st"> </span>v<span class="op">*</span>v<span class="op">*</span>t<span class="op">/</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>(a<span class="op">*</span>a) <span class="co"># for constant drift rate</span></a>
<a class="sourceLine" id="cb4-9" title="9">sv0_<span class="dv">9</span> &lt;-<span class="st"> </span><span class="kw">exp</span>((<span class="op">-</span><span class="dv">2</span><span class="op">*</span>v<span class="op">*</span>a<span class="op">*</span>w <span class="op">-</span><span class="st"> </span>v<span class="op">*</span>v<span class="op">*</span>t <span class="op">+</span><span class="st"> </span>sv<span class="op">*</span>sv<span class="op">*</span>a<span class="op">*</span>a<span class="op">*</span>w<span class="op">*</span>w)<span class="op">/</span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>sv<span class="op">*</span>sv<span class="op">*</span>t)) <span class="op">/</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="st">         </span>(a<span class="op">*</span>a<span class="op">*</span><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">+</span>sv<span class="op">*</span>sv<span class="op">*</span>t)) <span class="co"># for variable drift rate</span></a>
<a class="sourceLine" id="cb4-11" title="11">ks_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">ks</span>(t<span class="op">/</span>(a<span class="op">*</span>a), w, eps<span class="op">/</span>sv0) <span class="co"># = 2; the summation will only calculate 2 terms</span></a>
<a class="sourceLine" id="cb4-12" title="12">ks_<span class="dv">9</span> &lt;-<span class="st"> </span><span class="kw">ks</span>(t<span class="op">/</span>(a<span class="op">*</span>a), w, eps<span class="op">/</span>sv0_<span class="dv">9</span>) <span class="co"># = 5; but the summation needs 5 terms</span></a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="kw">cat</span>(<span class="st">&quot;the summation will only calculate&quot;</span>, ks_<span class="dv">0</span>, <span class="st">&quot;terms, but it needs&quot;</span>, ks_<span class="dv">9</span>, <span class="st">&quot;terms.&quot;</span>)</a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; the summation will only calculate 2 terms, but it needs 5 terms.</span></a></code></pre></div>
</div>
</div>
<div id="fit" class="section level1">
<h1>Validating Fitting (Optimization) Using the Density Functions</h1>
<hr class="sec1">
<p>Perhaps the most practical use of <code>dfddm</code> is to use it in an optimization setting, such as fitting DDM parameters to real-world data, and this section will show that all of the methods implemented in <code>dfddm</code> yield the same results in this setting. The parameters that we will fit are: <span class="math inline">\(a\)</span> (threshold separation), <span class="math inline">\(v\)</span> (drift rate), <span class="math inline">\(t_0\)</span> (non-decision time/response time constant), <span class="math inline">\(w\)</span> (relative starting point), and <span class="math inline">\(sv\)</span> (inter-trial-variability of drift). Since the example data we are using consists of two different item types that each require a different correct response (i.e., for one item type the correct response is mapped to the lower boundary and for the other item type the correct response is mapped to the upper boundary), the model includes two different versions of <span class="math inline">\(v\)</span> (drift rate): <span class="math inline">\(v_\ell\)</span> for fitting to the truthful lower boundary, and <span class="math inline">\(v_u\)</span> for fitting to the truthful upper boundary. As many of the approximations in <code>dfddm</code> have different styles, we only test a subset of all the available methods in <code>dfddm</code> to avoid unnecessary testing. After using the various density function approximations in fitting the DDM to real-world data, we then validate that the produced parameter estimates are consistent across the various methods within a given error tolerance.</p>
<div id="fit-gen" class="section level2">
<h2>Generating the Parameter Estimates Using Real-World Data</h2>
<p>We use a range of different initial parameter values for the optimization function to ensure that none of the methods encounters a problem in the parameter space. However, we need to slightly restrict the starting values to prevent fitting issues with some of the small-time methods; these restrictions are discussed in <a href="#fit-gen-fun">a later subsection</a> and in <a href="#fit-ke">Known Error 5</a>. We allow a difference of <span class="math inline">\(0.0001\)</span> across the methods for each combination of parameters since the density functions can return slightly different results (within <span class="math inline">\(2 \cdot \epsilon\)</span>), as <a href="#expl-dens-test">discussed earlier</a> in this vignette. The following subsections will define all of the functions used to generate the fittings and provide the code to run the full fitting. Since running the full fitting for all of the individuals in the data takes a long time, we will forgo running the fitting in this vignette and instead read pre-fit parameter estimates that used the provided code.</p>
<p>To avoid too many repetitious plots, we will only include six of the methods from the <a href="#den-gen">previous section</a> that illustrate the different variations and implementations of the density functions. We include: all three small-time implementations in <code>dfddm</code>, the two implementations in <code>dfddm</code> that combine the small-time and large-time, and the one method available in the <code>rtdists</code> package. We only use a selection of the methods available in <code>dfddm</code> to avoid redundancy in our testing since most of the methods have multiple sibling approximations that are extremely similar. Moreover, we do not require the <code>RWiener</code> package nor the Gondan raw <code>R</code> code because the associated density function approximations do not include an option for variability in drift rate. While we can convert the constant drift rate density to the variable drift rate density using a multiplicative factor, the densities are still <a href="#gon-m">potentially calculated incorrectly</a>. For more details on the differences between the constant drift rate density functions and their variable drift rate counterparts, see the <a href="math.html#mathematical-background">Math Vignette</a>.</p>
<p>First, we load the necessary packages.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">library</span>(<span class="st">&quot;fddm&quot;</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">library</span>(<span class="st">&quot;rtdists&quot;</span>)</a></code></pre></div>
<div id="fit-gen-llf" class="section level3">
<h3>Log-Likelihood Functions</h3>
<p>This code chunk defines the log-likelihood functions used in the optimization algorithm. The log-likelihood functions are fairly straightforward and split the responses and associated response times by the true item status (i.e., the correct response) to enable fitting distinct drift rates (<span class="math inline">\(v_\ell\)</span> for the items in which the correct response is the lower boundary and <span class="math inline">\(v_u\)</span> for the items for which the correct response is the upper boundary). In addition, the log-likelihood functions heavily penalize any combination of parameters that returns a log-density of <span class="math inline">\(-\infty\)</span> (equivalent to a regular density of <span class="math inline">\(0\)</span>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">ll_fs_SWSE_<span class="dv">17</span> &lt;-<span class="st"> </span><span class="cf">function</span>(pars, rt, resp, truth, err_tol) {</a>
<a class="sourceLine" id="cb6-2" title="2">  rtu &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-3" title="3">  rtl &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-4" title="4">  respu &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-5" title="5">  respl &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="co"># the truth is &quot;upper&quot; so use vu</span></a>
<a class="sourceLine" id="cb6-8" title="8">  densu &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtu, <span class="dt">response =</span> respu, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb6-9" title="9">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-10" title="10">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;SWSE&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-11" title="11">                 <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-12" title="12">  <span class="co"># the truth is &quot;lower&quot; so use vl</span></a>
<a class="sourceLine" id="cb6-13" title="13">  densl &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtl, <span class="dt">response =</span> respl, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb6-14" title="14">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-15" title="15">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;SWSE&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-16" title="16">                 <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18">  densities &lt;-<span class="st"> </span><span class="kw">c</span>(densu, densl)</a>
<a class="sourceLine" id="cb6-19" title="19">  <span class="cf">if</span> (<span class="kw">any</span>(<span class="op">!</span><span class="kw">is.finite</span>(densities))) <span class="kw">return</span>(<span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="kw">return</span>(<span class="op">-</span><span class="kw">sum</span>(densities))</a>
<a class="sourceLine" id="cb6-21" title="21">}</a>
<a class="sourceLine" id="cb6-22" title="22"></a>
<a class="sourceLine" id="cb6-23" title="23">ll_fs_Gon_<span class="dv">17</span> &lt;-<span class="st"> </span><span class="cf">function</span>(pars, rt, resp, truth, err_tol) {</a>
<a class="sourceLine" id="cb6-24" title="24">  rtu &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-25" title="25">  rtl &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-26" title="26">  respu &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-27" title="27">  respl &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-28" title="28"></a>
<a class="sourceLine" id="cb6-29" title="29">  <span class="co"># the truth is &quot;upper&quot; so use vu</span></a>
<a class="sourceLine" id="cb6-30" title="30">  densu &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtu, <span class="dt">response =</span> respu, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb6-31" title="31">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-32" title="32">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-33" title="33">                 <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-34" title="34">  <span class="co"># the truth is &quot;lower&quot; so use vl</span></a>
<a class="sourceLine" id="cb6-35" title="35">  densl &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtl, <span class="dt">response =</span> respl, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb6-36" title="36">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-37" title="37">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-38" title="38">                 <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-39" title="39"></a>
<a class="sourceLine" id="cb6-40" title="40">  densities &lt;-<span class="st"> </span><span class="kw">c</span>(densu, densl)</a>
<a class="sourceLine" id="cb6-41" title="41">  <span class="cf">if</span> (<span class="kw">any</span>(<span class="op">!</span><span class="kw">is.finite</span>(densities))) <span class="kw">return</span>(<span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb6-42" title="42">  <span class="kw">return</span>(<span class="op">-</span><span class="kw">sum</span>(densities))</a>
<a class="sourceLine" id="cb6-43" title="43">}</a>
<a class="sourceLine" id="cb6-44" title="44"></a>
<a class="sourceLine" id="cb6-45" title="45">ll_fs_Nav_<span class="dv">17</span> &lt;-<span class="st"> </span><span class="cf">function</span>(pars, rt, resp, truth, err_tol) {</a>
<a class="sourceLine" id="cb6-46" title="46">  rtu &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-47" title="47">  rtl &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-48" title="48">  respu &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-49" title="49">  respl &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-50" title="50"></a>
<a class="sourceLine" id="cb6-51" title="51">  <span class="co"># the truth is &quot;upper&quot; so use vu</span></a>
<a class="sourceLine" id="cb6-52" title="52">  densu &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtu, <span class="dt">response =</span> respu, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb6-53" title="53">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-54" title="54">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-55" title="55">                 <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-56" title="56">  <span class="co"># the truth is &quot;lower&quot; so use vl</span></a>
<a class="sourceLine" id="cb6-57" title="57">  densl &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtl, <span class="dt">response =</span> respl, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb6-58" title="58">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-59" title="59">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-60" title="60">                 <span class="dt">scale =</span> <span class="st">&quot;small&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-61" title="61"></a>
<a class="sourceLine" id="cb6-62" title="62">  densities &lt;-<span class="st"> </span><span class="kw">c</span>(densu, densl)</a>
<a class="sourceLine" id="cb6-63" title="63">  <span class="cf">if</span> (<span class="kw">any</span>(<span class="op">!</span><span class="kw">is.finite</span>(densities))) <span class="kw">return</span>(<span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb6-64" title="64">  <span class="kw">return</span>(<span class="op">-</span><span class="kw">sum</span>(densities))</a>
<a class="sourceLine" id="cb6-65" title="65">}</a>
<a class="sourceLine" id="cb6-66" title="66"></a>
<a class="sourceLine" id="cb6-67" title="67">ll_fb_Gon_<span class="dv">17</span> &lt;-<span class="st"> </span><span class="cf">function</span>(pars, rt, resp, truth, err_tol) {</a>
<a class="sourceLine" id="cb6-68" title="68">  rtu &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-69" title="69">  rtl &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-70" title="70">  respu &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-71" title="71">  respl &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-72" title="72"></a>
<a class="sourceLine" id="cb6-73" title="73">  <span class="co"># the truth is &quot;upper&quot; so use vu</span></a>
<a class="sourceLine" id="cb6-74" title="74">  densu &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtu, <span class="dt">response =</span> respu, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb6-75" title="75">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-76" title="76">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-77" title="77">                 <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-78" title="78">  <span class="co"># the truth is &quot;lower&quot; so use vl</span></a>
<a class="sourceLine" id="cb6-79" title="79">  densl &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtl, <span class="dt">response =</span> respl, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb6-80" title="80">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-81" title="81">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;Gondan&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-82" title="82">                 <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-83" title="83"></a>
<a class="sourceLine" id="cb6-84" title="84">  densities &lt;-<span class="st"> </span><span class="kw">c</span>(densu, densl)</a>
<a class="sourceLine" id="cb6-85" title="85">  <span class="cf">if</span> (<span class="kw">any</span>(<span class="op">!</span><span class="kw">is.finite</span>(densities))) <span class="kw">return</span>(<span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb6-86" title="86">  <span class="kw">return</span>(<span class="op">-</span><span class="kw">sum</span>(densities))</a>
<a class="sourceLine" id="cb6-87" title="87">}</a>
<a class="sourceLine" id="cb6-88" title="88"></a>
<a class="sourceLine" id="cb6-89" title="89">ll_fb_Nav_<span class="dv">17</span> &lt;-<span class="st"> </span><span class="cf">function</span>(pars, rt, resp, truth, err_tol) {</a>
<a class="sourceLine" id="cb6-90" title="90">  rtu &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-91" title="91">  rtl &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-92" title="92">  respu &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-93" title="93">  respl &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-94" title="94"></a>
<a class="sourceLine" id="cb6-95" title="95">  <span class="co"># the truth is &quot;upper&quot; so use vu</span></a>
<a class="sourceLine" id="cb6-96" title="96">  densu &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtu, <span class="dt">response =</span> respu, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb6-97" title="97">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-98" title="98">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-99" title="99">                 <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-100" title="100">  <span class="co"># the truth is &quot;lower&quot; so use vl</span></a>
<a class="sourceLine" id="cb6-101" title="101">  densl &lt;-<span class="st"> </span><span class="kw">dfddm</span>(<span class="dt">rt =</span> rtl, <span class="dt">response =</span> respl, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb6-102" title="102">                 <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">w =</span> pars[[<span class="dv">5</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-103" title="103">                 <span class="dt">n_terms_small =</span> <span class="st">&quot;Navarro&quot;</span>, <span class="dt">summation_small =</span> <span class="st">&quot;2017&quot;</span>,</a>
<a class="sourceLine" id="cb6-104" title="104">                 <span class="dt">scale =</span> <span class="st">&quot;both&quot;</span>, <span class="dt">err_tol =</span> err_tol)</a>
<a class="sourceLine" id="cb6-105" title="105"></a>
<a class="sourceLine" id="cb6-106" title="106">  densities &lt;-<span class="st"> </span><span class="kw">c</span>(densu, densl)</a>
<a class="sourceLine" id="cb6-107" title="107">  <span class="cf">if</span> (<span class="kw">any</span>(<span class="op">!</span><span class="kw">is.finite</span>(densities))) <span class="kw">return</span>(<span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb6-108" title="108">  <span class="kw">return</span>(<span class="op">-</span><span class="kw">sum</span>(densities))</a>
<a class="sourceLine" id="cb6-109" title="109">}</a>
<a class="sourceLine" id="cb6-110" title="110"></a>
<a class="sourceLine" id="cb6-111" title="111">ll_RTDists &lt;-<span class="st"> </span><span class="cf">function</span>(pars, rt, resp, truth) {</a>
<a class="sourceLine" id="cb6-112" title="112">  rtu &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-113" title="113">  rtl &lt;-<span class="st"> </span>rt[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-114" title="114">  respu &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;upper&quot;</span>]</a>
<a class="sourceLine" id="cb6-115" title="115">  respl &lt;-<span class="st"> </span>resp[truth <span class="op">==</span><span class="st"> &quot;lower&quot;</span>]</a>
<a class="sourceLine" id="cb6-116" title="116"></a>
<a class="sourceLine" id="cb6-117" title="117">  <span class="co"># the truth is &quot;upper&quot; so use vu</span></a>
<a class="sourceLine" id="cb6-118" title="118">  densu &lt;-<span class="st"> </span><span class="kw">ddiffusion</span>(rtu, respu, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb6-119" title="119">                      <span class="dt">z =</span> pars[[<span class="dv">5</span>]]<span class="op">*</span>pars[[<span class="dv">3</span>]], <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]])</a>
<a class="sourceLine" id="cb6-120" title="120">  <span class="co"># the truth is &quot;lower&quot; so use vl</span></a>
<a class="sourceLine" id="cb6-121" title="121">  densl &lt;-<span class="st"> </span><span class="kw">ddiffusion</span>(rtl, respl, <span class="dt">a =</span> pars[[<span class="dv">3</span>]], <span class="dt">v =</span> pars[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb6-122" title="122">                      <span class="dt">z =</span> pars[[<span class="dv">5</span>]]<span class="op">*</span>pars[[<span class="dv">3</span>]], <span class="dt">t0 =</span> pars[[<span class="dv">4</span>]], <span class="dt">sv =</span> pars[[<span class="dv">6</span>]])</a>
<a class="sourceLine" id="cb6-123" title="123"></a>
<a class="sourceLine" id="cb6-124" title="124">  densities &lt;-<span class="st"> </span><span class="kw">c</span>(densu, densl)</a>
<a class="sourceLine" id="cb6-125" title="125">  <span class="cf">if</span> (<span class="kw">any</span>(densities <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)) <span class="kw">return</span>(<span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb6-126" title="126">  <span class="kw">return</span>(<span class="op">-</span><span class="kw">sum</span>(<span class="kw">log</span>(densities)))</a>
<a class="sourceLine" id="cb6-127" title="127">}</a></code></pre></div>
</div>
<div id="fit-gen-fun" class="section level3">
<h3>Fitting Function</h3>
<p>We use a different set of initial parameter values for each combination of data set and method. In a real-life situation we would probably do so using random initial parameter values to avoid local minima. Here we do this with a fixed set of initial parameter values to ensure that the different method produce the same results for different starting points. However, there are a couple of restrictions to these initial values that we must address (we would also have to do so if we picked the initial values randomly). The parameter <span class="math inline">\(t_0\)</span> must be less than the response time, so we set the initial values for <span class="math inline">\(t_0\)</span> to be strictly less than the minimum response time according to each individual in the input data.frame. In addition, the optimization algorithm encounters problems for specific values of <span class="math inline">\(a\)</span> when using the log-likelihood function that is based on the Navarro small-time density function approximation, and this is explained in <a href="#fit-ke">Known Errors</a>.</p>
<p>Furthermore, we must place a lower bound on <span class="math inline">\(a\)</span> because the optimization algorithm occasionally evaluates the log-likelihood functions (and thus the underlying density function approximations) using values of <span class="math inline">\(a\)</span> that are very close to zero in an effort to fully explore the parameter space. In these cases, the small-time approximations struggle because <span class="math inline">\(a\)</span> inversely scales the input response time and effectively changes the input response time into a very large one. In particular, an extremely small value of <span class="math inline">\(a\)</span> can cause the SWSE small-time density approximation to run for a very long time; to prevent this, we bound <span class="math inline">\(a\)</span> below by <span class="math inline">\(0.05\)</span> as it is a very small value such that anything less would be of no psychological significance to the model. In common use this is not an issue because very small values of <span class="math inline">\(a\)</span> do not make any sense with regard to the psychological interpretation of the parameter, but this issue can arise in an exploratory optimization environment.</p>
<p>The following code chunk defines the function that will run the optimization and produce the fitted parameter estimates for <span class="math inline">\(v_u\)</span>, <span class="math inline">\(v_\ell\)</span>, <span class="math inline">\(a\)</span>, <span class="math inline">\(t_0\)</span>, <span class="math inline">\(w\)</span>, and <span class="math inline">\(sv\)</span>. As <a href="#fit-gen">discussed above</a>, we only use a selection of methods from those available in <code>dfddm</code>. This fitting function will run the optimization for each set of initial parameter values and store the resulting convergence code (either <span class="math inline">\(0\)</span> indicating successful convergence or <span class="math inline">\(1\)</span> indicating unsuccessful convergence), minimized value of the objective log-likelihood function, and parameter estimates.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">rt_fit &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">id_idx =</span> <span class="ot">NULL</span>, <span class="dt">rt_idx =</span> <span class="ot">NULL</span>, <span class="dt">response_idx =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb7-2" title="2">                   <span class="dt">truth_idx =</span> <span class="ot">NULL</span>, <span class="dt">response_upper =</span> <span class="ot">NULL</span>, <span class="dt">err_tol =</span> <span class="fl">1e-6</span>) {</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="co"># Format data for fitting</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="cf">if</span> (<span class="kw">all</span>(<span class="kw">is.null</span>(id_idx), <span class="kw">is.null</span>(rt_idx), <span class="kw">is.null</span>(response_idx),</a>
<a class="sourceLine" id="cb7-6" title="6">      <span class="kw">is.null</span>(truth_idx), <span class="kw">is.null</span>(response_upper))) {</a>
<a class="sourceLine" id="cb7-7" title="7">    df &lt;-<span class="st"> </span>data <span class="co"># assume input data is already formatted</span></a>
<a class="sourceLine" id="cb7-8" title="8">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="cf">if</span>(<span class="kw">any</span>(data[,rt_idx] <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)) {</a>
<a class="sourceLine" id="cb7-10" title="10">      <span class="kw">stop</span>(<span class="st">&quot;Input data contains negative response times; fit will not be run.&quot;</span>)</a>
<a class="sourceLine" id="cb7-11" title="11">    }</a>
<a class="sourceLine" id="cb7-12" title="12">    <span class="cf">if</span>(<span class="kw">any</span>(<span class="kw">is.na</span>(data[,response_idx]))) {</a>
<a class="sourceLine" id="cb7-13" title="13">      <span class="kw">stop</span>(<span class="st">&quot;Input data contains invalid responses (NA); fit will not be run.&quot;</span>)</a>
<a class="sourceLine" id="cb7-14" title="14">    }</a>
<a class="sourceLine" id="cb7-15" title="15"></a>
<a class="sourceLine" id="cb7-16" title="16">    nr &lt;-<span class="st"> </span><span class="kw">nrow</span>(data)</a>
<a class="sourceLine" id="cb7-17" title="17">    df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">character</span>(nr),</a>
<a class="sourceLine" id="cb7-18" title="18">                     <span class="dt">rt =</span> <span class="kw">double</span>(nr),</a>
<a class="sourceLine" id="cb7-19" title="19">                     <span class="dt">response =</span> <span class="kw">character</span>(nr),</a>
<a class="sourceLine" id="cb7-20" title="20">                     <span class="dt">truth =</span> <span class="kw">character</span>(nr),</a>
<a class="sourceLine" id="cb7-21" title="21">                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-22" title="22"></a>
<a class="sourceLine" id="cb7-23" title="23">    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(id_idx)) { <span class="co"># relabel identification tags</span></a>
<a class="sourceLine" id="cb7-24" title="24">      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(id_idx)) {</a>
<a class="sourceLine" id="cb7-25" title="25">        idi &lt;-<span class="st"> </span><span class="kw">unique</span>(data[,id_idx[i]])</a>
<a class="sourceLine" id="cb7-26" title="26">        <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(idi)) {</a>
<a class="sourceLine" id="cb7-27" title="27">          df<span class="op">$</span>id[data[,id_idx[i]] <span class="op">==</span><span class="st"> </span>idi[j]] &lt;-<span class="st"> </span><span class="kw">paste</span>(df<span class="op">$</span>id[data[,id_idx[i]] <span class="op">==</span><span class="st"> </span>idi[j]], idi[j], <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb7-28" title="28">        }</a>
<a class="sourceLine" id="cb7-29" title="29">      }</a>
<a class="sourceLine" id="cb7-30" title="30">      df<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">trimws</span>(df<span class="op">$</span>id, <span class="dt">which =</span> <span class="st">&quot;left&quot;</span>)</a>
<a class="sourceLine" id="cb7-31" title="31">    }</a>
<a class="sourceLine" id="cb7-32" title="32"></a>
<a class="sourceLine" id="cb7-33" title="33">    df<span class="op">$</span>rt &lt;-<span class="st"> </span><span class="kw">as.double</span>(data[,rt_idx])</a>
<a class="sourceLine" id="cb7-34" title="34"></a>
<a class="sourceLine" id="cb7-35" title="35">    df<span class="op">$</span>response &lt;-<span class="st"> &quot;lower&quot;</span></a>
<a class="sourceLine" id="cb7-36" title="36">    df<span class="op">$</span>response[data[,response_idx] <span class="op">==</span><span class="st"> </span>response_upper] &lt;-<span class="st"> &quot;upper&quot;</span></a>
<a class="sourceLine" id="cb7-37" title="37"></a>
<a class="sourceLine" id="cb7-38" title="38">    df<span class="op">$</span>truth &lt;-<span class="st"> &quot;lower&quot;</span></a>
<a class="sourceLine" id="cb7-39" title="39">    df<span class="op">$</span>truth[data[,truth_idx] <span class="op">==</span><span class="st"> </span>response_upper] &lt;-<span class="st"> &quot;upper&quot;</span></a>
<a class="sourceLine" id="cb7-40" title="40">  }</a>
<a class="sourceLine" id="cb7-41" title="41"></a>
<a class="sourceLine" id="cb7-42" title="42">  <span class="co"># Preliminaries</span></a>
<a class="sourceLine" id="cb7-43" title="43">  ids &lt;-<span class="st"> </span><span class="kw">unique</span>(df<span class="op">$</span>id)</a>
<a class="sourceLine" id="cb7-44" title="44">  nids &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">length</span>(ids), <span class="dv">1</span>) <span class="co"># if inds is null, there is only one individual</span></a>
<a class="sourceLine" id="cb7-45" title="45"></a>
<a class="sourceLine" id="cb7-46" title="46">  init_vals &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">vu =</span> <span class="kw">c</span>( <span class="dv">0</span>,  <span class="dv">10</span>, <span class="fl">-.5</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,   <span class="dv">0</span>,  <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-47" title="47">                          <span class="dt">vl =</span> <span class="kw">c</span>( <span class="dv">0</span>, <span class="dv">-10</span>,  <span class="fl">.5</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,   <span class="dv">0</span>,  <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-48" title="48">                          <span class="dt">a  =</span> <span class="kw">c</span>( <span class="dv">1</span>,   <span class="dv">1</span>,   <span class="dv">1</span>, <span class="fl">.5</span>,  <span class="dv">5</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,   <span class="dv">1</span>,  <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb7-49" title="49">                          <span class="dt">t0 =</span> <span class="kw">c</span>( <span class="dv">0</span>,   <span class="dv">0</span>,   <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,   <span class="dv">0</span>,  <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-50" title="50">                          <span class="dt">w  =</span> <span class="kw">c</span>(.<span class="dv">5</span>,  <span class="fl">.5</span>,  <span class="fl">.5</span>, <span class="fl">.5</span>, <span class="fl">.5</span>, <span class="fl">.5</span>, <span class="fl">.5</span>, <span class="fl">.2</span>, <span class="fl">.8</span>,  <span class="fl">.5</span>, <span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb7-51" title="51">                          <span class="dt">sv =</span> <span class="kw">c</span>( <span class="dv">1</span>,   <span class="dv">1</span>,   <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>, <span class="fl">.05</span>,  <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb7-52" title="52">  ninit_vals &lt;-<span class="st"> </span><span class="kw">nrow</span>(init_vals)</a>
<a class="sourceLine" id="cb7-53" title="53"></a>
<a class="sourceLine" id="cb7-54" title="54">  algo_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;fs_SWSE_17&quot;</span>, ninit_vals), <span class="kw">rep</span>(<span class="st">&quot;fs_Gon_17&quot;</span>, ninit_vals),</a>
<a class="sourceLine" id="cb7-55" title="55">                  <span class="kw">rep</span>(<span class="st">&quot;fs_Nav_17&quot;</span>, ninit_vals), <span class="kw">rep</span>(<span class="st">&quot;fb_Gon_17&quot;</span>, ninit_vals),</a>
<a class="sourceLine" id="cb7-56" title="56">                  <span class="kw">rep</span>(<span class="st">&quot;fb_Nav_17&quot;</span>, ninit_vals), <span class="kw">rep</span>(<span class="st">&quot;rtdists&quot;</span>, ninit_vals))</a>
<a class="sourceLine" id="cb7-57" title="57">  nalgos &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(algo_names))</a>
<a class="sourceLine" id="cb7-58" title="58">  ni &lt;-<span class="st"> </span>nalgos<span class="op">*</span>ninit_vals</a>
<a class="sourceLine" id="cb7-59" title="59"></a>
<a class="sourceLine" id="cb7-60" title="60">  <span class="co"># Initilize the result dataframe</span></a>
<a class="sourceLine" id="cb7-61" title="61">  cnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Algorithm&quot;</span>, <span class="st">&quot;Convergence&quot;</span>, <span class="st">&quot;Objective&quot;</span>,</a>
<a class="sourceLine" id="cb7-62" title="62">              <span class="st">&quot;vu_init&quot;</span>, <span class="st">&quot;vl_init&quot;</span>, <span class="st">&quot;a_init&quot;</span>, <span class="st">&quot;t0_init&quot;</span>, <span class="st">&quot;w_init&quot;</span>, <span class="st">&quot;sv_init&quot;</span>,</a>
<a class="sourceLine" id="cb7-63" title="63">              <span class="st">&quot;vu_fit&quot;</span>, <span class="st">&quot;vl_fit&quot;</span>, <span class="st">&quot;a_fit&quot;</span>, <span class="st">&quot;t0_fit&quot;</span>, <span class="st">&quot;w_fit&quot;</span>, <span class="st">&quot;sv_fit&quot;</span>)</a>
<a class="sourceLine" id="cb7-64" title="64">  res &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="kw">length</span>(cnames), <span class="dt">nrow =</span> nids<span class="op">*</span>ninit_vals<span class="op">*</span>nalgos))</a>
<a class="sourceLine" id="cb7-65" title="65">  <span class="kw">colnames</span>(res) &lt;-<span class="st"> </span>cnames</a>
<a class="sourceLine" id="cb7-66" title="66"></a>
<a class="sourceLine" id="cb7-67" title="67">  <span class="co"># label the result dataframe</span></a>
<a class="sourceLine" id="cb7-68" title="68">  res<span class="op">$</span>Algorithm &lt;-<span class="st"> </span>algo_names <span class="co"># label algorithms</span></a>
<a class="sourceLine" id="cb7-69" title="69">  res<span class="op">$</span>vu_init &lt;-<span class="st"> </span>init_vals<span class="op">$</span>vu <span class="co"># label initial vu</span></a>
<a class="sourceLine" id="cb7-70" title="70">  res<span class="op">$</span>vl_init &lt;-<span class="st"> </span>init_vals<span class="op">$</span>vl <span class="co"># label initial vl</span></a>
<a class="sourceLine" id="cb7-71" title="71">  res<span class="op">$</span>a_init  &lt;-<span class="st"> </span>init_vals<span class="op">$</span>a  <span class="co"># label initial a</span></a>
<a class="sourceLine" id="cb7-72" title="72">  res<span class="op">$</span>w_init  &lt;-<span class="st"> </span>init_vals<span class="op">$</span>w  <span class="co"># label initial w</span></a>
<a class="sourceLine" id="cb7-73" title="73">  res<span class="op">$</span>sv_init &lt;-<span class="st"> </span>init_vals<span class="op">$</span>sv <span class="co"># label initial sv</span></a>
<a class="sourceLine" id="cb7-74" title="74"></a>
<a class="sourceLine" id="cb7-75" title="75">  <span class="co"># Loop through each individual and starting values</span></a>
<a class="sourceLine" id="cb7-76" title="76">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nids) {</a>
<a class="sourceLine" id="cb7-77" title="77">    <span class="co"># extract data for id i</span></a>
<a class="sourceLine" id="cb7-78" title="78">    dfi &lt;-<span class="st"> </span>df[df<span class="op">$</span>id <span class="op">==</span><span class="st"> </span>ids[i],]</a>
<a class="sourceLine" id="cb7-79" title="79">    rti &lt;-<span class="st"> </span>dfi<span class="op">$</span>rt</a>
<a class="sourceLine" id="cb7-80" title="80">    respi &lt;-<span class="st"> </span>dfi<span class="op">$</span>response</a>
<a class="sourceLine" id="cb7-81" title="81">    truthi &lt;-<span class="st"> </span>dfi<span class="op">$</span>truth</a>
<a class="sourceLine" id="cb7-82" title="82"></a>
<a class="sourceLine" id="cb7-83" title="83">    <span class="co"># starting value for t0 must be smaller than the smallest rt</span></a>
<a class="sourceLine" id="cb7-84" title="84">    min_rti &lt;-<span class="st"> </span><span class="kw">min</span>(rti)</a>
<a class="sourceLine" id="cb7-85" title="85">    t0_lo &lt;-<span class="st"> </span><span class="fl">0.01</span><span class="op">*</span>min_rti</a>
<a class="sourceLine" id="cb7-86" title="86">    t0_me &lt;-<span class="st"> </span><span class="fl">0.50</span><span class="op">*</span>min_rti</a>
<a class="sourceLine" id="cb7-87" title="87">    t0_hi &lt;-<span class="st"> </span><span class="fl">0.99</span><span class="op">*</span>min_rti</a>
<a class="sourceLine" id="cb7-88" title="88">    init_vals<span class="op">$</span>t0 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(t0_me, <span class="dv">5</span>), t0_lo, t0_hi, <span class="kw">rep</span>(t0_me, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb7-89" title="89"></a>
<a class="sourceLine" id="cb7-90" title="90">    <span class="co"># label the result dataframe</span></a>
<a class="sourceLine" id="cb7-91" title="91">    res<span class="op">$</span>ID[((i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>(i<span class="op">*</span>ni)] &lt;-<span class="st"> </span>ids[i] <span class="co"># label individuals</span></a>
<a class="sourceLine" id="cb7-92" title="92">    res<span class="op">$</span>t0_init[((i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>(i<span class="op">*</span>ni)] &lt;-<span class="st"> </span>init_vals<span class="op">$</span>t0 <span class="co"># label initial t0</span></a>
<a class="sourceLine" id="cb7-93" title="93"></a>
<a class="sourceLine" id="cb7-94" title="94">    <span class="co"># loop through all of the starting values</span></a>
<a class="sourceLine" id="cb7-95" title="95">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ninit_vals) {</a>
<a class="sourceLine" id="cb7-96" title="96">      temp &lt;-<span class="st"> </span><span class="kw">nlminb</span>(init_vals[j,], ll_fs_SWSE_<span class="dv">17</span>,</a>
<a class="sourceLine" id="cb7-97" title="97">                     <span class="dt">rt =</span> rti, <span class="dt">resp =</span> respi, <span class="dt">truth =</span> truthi, <span class="dt">err_tol =</span> err_tol,</a>
<a class="sourceLine" id="cb7-98" title="98">                     <span class="co"># limits:   vu,   vl,   a,  t0, w,  sv</span></a>
<a class="sourceLine" id="cb7-99" title="99">                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="fl">.05</span>,   <span class="dv">0</span>, <span class="dv">0</span>,   <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-100" title="100">                     <span class="dt">upper =</span> <span class="kw">c</span>( <span class="ot">Inf</span>,  <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dv">1</span>, <span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb7-101" title="101">      res<span class="op">$</span>Convergence[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">0</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>convergence</a>
<a class="sourceLine" id="cb7-102" title="102">      res<span class="op">$</span>Objective[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">0</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>objective</a>
<a class="sourceLine" id="cb7-103" title="103">      res[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">0</span><span class="op">*</span>ninit_vals<span class="op">+</span>j, <span class="dv">11</span><span class="op">:</span><span class="dv">16</span>] &lt;-<span class="st"> </span>temp<span class="op">$</span>par</a>
<a class="sourceLine" id="cb7-104" title="104"></a>
<a class="sourceLine" id="cb7-105" title="105">      temp &lt;-<span class="st"> </span><span class="kw">nlminb</span>(init_vals[j,], ll_fs_Gon_<span class="dv">17</span>,</a>
<a class="sourceLine" id="cb7-106" title="106">                     <span class="dt">rt =</span> rti, <span class="dt">resp =</span> respi, <span class="dt">truth =</span> truthi, <span class="dt">err_tol =</span> err_tol,</a>
<a class="sourceLine" id="cb7-107" title="107">                     <span class="co"># limits:   vu,   vl,   a,  t0, w,  sv</span></a>
<a class="sourceLine" id="cb7-108" title="108">                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="fl">.05</span>,   <span class="dv">0</span>, <span class="dv">0</span>,   <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-109" title="109">                     <span class="dt">upper =</span> <span class="kw">c</span>( <span class="ot">Inf</span>,  <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dv">1</span>, <span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb7-110" title="110">      res<span class="op">$</span>Convergence[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">1</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>convergence</a>
<a class="sourceLine" id="cb7-111" title="111">      res<span class="op">$</span>Objective[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">1</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>objective</a>
<a class="sourceLine" id="cb7-112" title="112">      res[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">1</span><span class="op">*</span>ninit_vals<span class="op">+</span>j, <span class="dv">11</span><span class="op">:</span><span class="dv">16</span>] &lt;-<span class="st"> </span>temp<span class="op">$</span>par</a>
<a class="sourceLine" id="cb7-113" title="113"></a>
<a class="sourceLine" id="cb7-114" title="114">      temp &lt;-<span class="st"> </span><span class="kw">nlminb</span>(init_vals[j,], ll_fs_Nav_<span class="dv">17</span>,</a>
<a class="sourceLine" id="cb7-115" title="115">                     <span class="dt">rt =</span> rti, <span class="dt">resp =</span> respi, <span class="dt">truth =</span> truthi, <span class="dt">err_tol =</span> err_tol,</a>
<a class="sourceLine" id="cb7-116" title="116">                     <span class="co"># limits:   vu,   vl,   a,  t0, w,  sv</span></a>
<a class="sourceLine" id="cb7-117" title="117">                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="fl">.05</span>,   <span class="dv">0</span>, <span class="dv">0</span>,   <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-118" title="118">                     <span class="dt">upper =</span> <span class="kw">c</span>( <span class="ot">Inf</span>,  <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dv">1</span>, <span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb7-119" title="119">      res<span class="op">$</span>Convergence[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">2</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>convergence</a>
<a class="sourceLine" id="cb7-120" title="120">      res<span class="op">$</span>Objective[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">2</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>objective</a>
<a class="sourceLine" id="cb7-121" title="121">      res[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">2</span><span class="op">*</span>ninit_vals<span class="op">+</span>j, <span class="dv">11</span><span class="op">:</span><span class="dv">16</span>] &lt;-<span class="st"> </span>temp<span class="op">$</span>par</a>
<a class="sourceLine" id="cb7-122" title="122"></a>
<a class="sourceLine" id="cb7-123" title="123">      temp &lt;-<span class="st"> </span><span class="kw">nlminb</span>(init_vals[j,], ll_fb_Gon_<span class="dv">17</span>,</a>
<a class="sourceLine" id="cb7-124" title="124">                     <span class="dt">rt =</span> rti, <span class="dt">resp =</span> respi, <span class="dt">truth =</span> truthi, <span class="dt">err_tol =</span> err_tol,</a>
<a class="sourceLine" id="cb7-125" title="125">                     <span class="co"># limits:   vu,   vl,   a,  t0, w,  sv</span></a>
<a class="sourceLine" id="cb7-126" title="126">                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="fl">.05</span>,   <span class="dv">0</span>, <span class="dv">0</span>,   <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-127" title="127">                     <span class="dt">upper =</span> <span class="kw">c</span>( <span class="ot">Inf</span>,  <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dv">1</span>, <span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb7-128" title="128">      res<span class="op">$</span>Convergence[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">3</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>convergence</a>
<a class="sourceLine" id="cb7-129" title="129">      res<span class="op">$</span>Objective[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">3</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>objective</a>
<a class="sourceLine" id="cb7-130" title="130">      res[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">3</span><span class="op">*</span>ninit_vals<span class="op">+</span>j, <span class="dv">11</span><span class="op">:</span><span class="dv">16</span>] &lt;-<span class="st"> </span>temp<span class="op">$</span>par</a>
<a class="sourceLine" id="cb7-131" title="131"></a>
<a class="sourceLine" id="cb7-132" title="132">      temp &lt;-<span class="st"> </span><span class="kw">nlminb</span>(init_vals[j,], ll_fb_Nav_<span class="dv">17</span>,</a>
<a class="sourceLine" id="cb7-133" title="133">                     <span class="dt">rt =</span> rti, <span class="dt">resp =</span> respi, <span class="dt">truth =</span> truthi, <span class="dt">err_tol =</span> err_tol,</a>
<a class="sourceLine" id="cb7-134" title="134">                     <span class="co"># limits:   vu,   vl,   a,  t0, w,  sv</span></a>
<a class="sourceLine" id="cb7-135" title="135">                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="fl">.05</span>,   <span class="dv">0</span>, <span class="dv">0</span>,   <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-136" title="136">                     <span class="dt">upper =</span> <span class="kw">c</span>( <span class="ot">Inf</span>,  <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dv">1</span>, <span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb7-137" title="137">      res<span class="op">$</span>Convergence[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">4</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>convergence</a>
<a class="sourceLine" id="cb7-138" title="138">      res<span class="op">$</span>Objective[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">4</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>objective</a>
<a class="sourceLine" id="cb7-139" title="139">      res[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">4</span><span class="op">*</span>ninit_vals<span class="op">+</span>j, <span class="dv">11</span><span class="op">:</span><span class="dv">16</span>] &lt;-<span class="st"> </span>temp<span class="op">$</span>par</a>
<a class="sourceLine" id="cb7-140" title="140"></a>
<a class="sourceLine" id="cb7-141" title="141">      temp &lt;-<span class="st"> </span><span class="kw">nlminb</span>(init_vals[j,], ll_RTDists,</a>
<a class="sourceLine" id="cb7-142" title="142">                     <span class="dt">rt =</span> rti, <span class="dt">resp =</span> respi, <span class="dt">truth =</span> truthi,</a>
<a class="sourceLine" id="cb7-143" title="143">                     <span class="co"># limits:   vu,   vl,   a,  t0, w,  sv</span></a>
<a class="sourceLine" id="cb7-144" title="144">                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="fl">.05</span>,   <span class="dv">0</span>, <span class="dv">0</span>,   <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-145" title="145">                     <span class="dt">upper =</span> <span class="kw">c</span>( <span class="ot">Inf</span>,  <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dv">1</span>, <span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb7-146" title="146">      res<span class="op">$</span>Convergence[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">5</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>convergence</a>
<a class="sourceLine" id="cb7-147" title="147">      res<span class="op">$</span>Objective[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">5</span><span class="op">*</span>ninit_vals<span class="op">+</span>j] &lt;-<span class="st"> </span>temp<span class="op">$</span>objective</a>
<a class="sourceLine" id="cb7-148" title="148">      res[(i<span class="dv">-1</span>)<span class="op">*</span>ni<span class="op">+</span><span class="dv">5</span><span class="op">*</span>ninit_vals<span class="op">+</span>j, <span class="dv">11</span><span class="op">:</span><span class="dv">16</span>] &lt;-<span class="st"> </span>temp<span class="op">$</span>par</a>
<a class="sourceLine" id="cb7-149" title="149">    }</a>
<a class="sourceLine" id="cb7-150" title="150">  }</a>
<a class="sourceLine" id="cb7-151" title="151">  <span class="kw">return</span>(res)</a>
<a class="sourceLine" id="cb7-152" title="152">}</a></code></pre></div>
</div>
<div id="fit-run" class="section level3">
<h3>Running the Fitting</h3>
<p>As an example data set, we use the <code>med_dec</code> data that comes with <code>fddm</code>. This data contains the accuracy condition reported in <span class="citation">Trueblood et al. (2018)</span> investigating medical decision making among medical professionals (pathologists) and novices (i.e., undergraduate students). The task of participants was to judge whether pictures of blood cells show cancerous cells (i.e., blast cells) or non-cancerous cells (i.e., non-blast cells). The data set contains 200 decision per participant, based on pictures of 100 true cancerous cells and pictures of 100 true non-cancerous cells. We remove the trials without response (indicated by rt &lt; 0 in the data) before fitting.</p>
<p>Having set up the fitting functions in the above chunks of code, we could pass the <code>med_dec</code> data to this function to get the parameter estimates. However, as this takes a long time we skip the fitting in this vignette and instead read the pre-fit parameter estimates in the next section.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">data</span>(med_dec, <span class="dt">package =</span> <span class="st">&quot;fddm&quot;</span>)</a>
<a class="sourceLine" id="cb8-2" title="2">med_dec &lt;-<span class="st"> </span>med_dec[<span class="kw">which</span>(med_dec<span class="op">$</span>rt <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>),]</a>
<a class="sourceLine" id="cb8-3" title="3">fit &lt;-<span class="st"> </span><span class="kw">rt_fit</span>(med_dec, <span class="dt">id_idx =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">rt_idx =</span> <span class="dv">8</span>, <span class="dt">response_idx =</span> <span class="dv">7</span>,</a>
<a class="sourceLine" id="cb8-4" title="4">              <span class="dt">truth_idx =</span> <span class="dv">5</span>, <span class="dt">response_upper =</span> <span class="st">&quot;blast&quot;</span>, <span class="dt">err_tol =</span> <span class="fl">1e-6</span>)</a></code></pre></div>
</div>
</div>
<div id="fit-test" class="section level2">
<h2>Testing the Fitted Parameters</h2>
<p>Now we test the consistency of the fitted parameters using the various density function approximations. As <a href="#fit-gen">discussed above</a>, we use an allowable error tolerance of <span class="math inline">\(0.0001\)</span> to account for the slight differences in the output of the different density approximations. First, we define a function to determine the differences in the objective value of the log-likelihood function and the parameter estimates. For each set of initial parameter values, there is one objective value corresponding to each algorithm; we take the minimum of these objective values and use the associated parameter estimates as the best estimates. Then we use this set of best estimates to compare against each set parameter estimates that use the same initial parameter values. At the end of this prep function, we subset the fitted data to remove those fits that used the Navarro small-time approximation with an initial value of <span class="math inline">\(a \leq .75\)</span> (see <a href="#fit-ke">Known Error 5</a> below for more details). The following code chunk defines this function, which will be used next.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">fit_prep &lt;-<span class="st"> </span><span class="cf">function</span>(fit) {</a>
<a class="sourceLine" id="cb9-2" title="2">  nr &lt;-<span class="st"> </span><span class="kw">nrow</span>(fit)</a>
<a class="sourceLine" id="cb9-3" title="3">  fit<span class="op">$</span>Obj_diff &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nr)</a>
<a class="sourceLine" id="cb9-4" title="4">  fit<span class="op">$</span>vu_diff  &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nr)</a>
<a class="sourceLine" id="cb9-5" title="5">  fit<span class="op">$</span>vl_diff  &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nr)</a>
<a class="sourceLine" id="cb9-6" title="6">  fit<span class="op">$</span>a_diff   &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nr)</a>
<a class="sourceLine" id="cb9-7" title="7">  fit<span class="op">$</span>t0_diff  &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nr)</a>
<a class="sourceLine" id="cb9-8" title="8">  fit<span class="op">$</span>w_diff   &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nr)</a>
<a class="sourceLine" id="cb9-9" title="9">  fit<span class="op">$</span>sv_diff  &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nr)</a>
<a class="sourceLine" id="cb9-10" title="10"></a>
<a class="sourceLine" id="cb9-11" title="11">  ids &lt;-<span class="st"> </span><span class="kw">unique</span>(fit<span class="op">$</span>ID)</a>
<a class="sourceLine" id="cb9-12" title="12">  nids &lt;-<span class="st"> </span><span class="kw">length</span>(ids)</a>
<a class="sourceLine" id="cb9-13" title="13">  algos &lt;-<span class="st"> </span><span class="kw">unique</span>(fit<span class="op">$</span>Algorithm)</a>
<a class="sourceLine" id="cb9-14" title="14">  nalgos &lt;-<span class="st"> </span><span class="kw">length</span>(algos)</a>
<a class="sourceLine" id="cb9-15" title="15"></a>
<a class="sourceLine" id="cb9-16" title="16">  fit_idx &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">11</span><span class="op">:</span><span class="dv">16</span>)</a>
<a class="sourceLine" id="cb9-17" title="17">  dif_idx &lt;-<span class="st"> </span><span class="dv">17</span><span class="op">:</span><span class="dv">23</span></a>
<a class="sourceLine" id="cb9-18" title="18">  ninit &lt;-<span class="st"> </span><span class="kw">nrow</span>(<span class="kw">subset</span>(fit, ID <span class="op">==</span><span class="st"> </span>ids[<span class="dv">1</span>] <span class="op">&amp;</span><span class="st"> </span>Algorithm <span class="op">==</span><span class="st"> </span>algos[<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb9-19" title="19">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nids) {</a>
<a class="sourceLine" id="cb9-20" title="20">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ninit) {</a>
<a class="sourceLine" id="cb9-21" title="21">      actual_idx &lt;-<span class="st"> </span><span class="kw">seq</span>((i<span class="dv">-1</span>)<span class="op">*</span>ninit<span class="op">*</span>nalgos<span class="op">+</span>j, i<span class="op">*</span>ninit<span class="op">*</span>nalgos, <span class="dt">by =</span> ninit)</a>
<a class="sourceLine" id="cb9-22" title="22">      min_obj_idx &lt;-<span class="st"> </span>actual_idx[<span class="kw">which.min</span>(fit[actual_idx, <span class="dv">4</span>])]</a>
<a class="sourceLine" id="cb9-23" title="23">      best_fit &lt;-<span class="st"> </span>fit[min_obj_idx, fit_idx]</a>
<a class="sourceLine" id="cb9-24" title="24">      <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>(nalgos<span class="dv">-1</span>)) {</a>
<a class="sourceLine" id="cb9-25" title="25">        fit[(i<span class="dv">-1</span>)<span class="op">*</span>(ninit<span class="op">*</span>nalgos) <span class="op">+</span><span class="st"> </span>k<span class="op">*</span>ninit <span class="op">+</span><span class="st"> </span>j, dif_idx] &lt;-</a>
<a class="sourceLine" id="cb9-26" title="26"><span class="st">          </span>fit[(i<span class="dv">-1</span>)<span class="op">*</span>(ninit<span class="op">*</span>nalgos) <span class="op">+</span><span class="st"> </span>k<span class="op">*</span>ninit <span class="op">+</span><span class="st"> </span>j, fit_idx] <span class="op">-</span><span class="st"> </span>best_fit</a>
<a class="sourceLine" id="cb9-27" title="27"></a>
<a class="sourceLine" id="cb9-28" title="28">      }</a>
<a class="sourceLine" id="cb9-29" title="29">    }</a>
<a class="sourceLine" id="cb9-30" title="30">  }</a>
<a class="sourceLine" id="cb9-31" title="31">  fit &lt;-<span class="st"> </span>fit[fit<span class="op">$</span>Algorithm <span class="op">!=</span><span class="st"> &quot;fs_Nav_17&quot;</span> <span class="op">|</span><span class="st"> </span>fit<span class="op">$</span>a_init <span class="op">&gt;</span><span class="st"> </span><span class="fl">.75</span>,] <span class="co"># KE 5</span></a>
<a class="sourceLine" id="cb9-32" title="32">  <span class="kw">return</span>(fit)</a>
<a class="sourceLine" id="cb9-33" title="33">}</a></code></pre></div>
<p>As previously mentioned, we will read the pre-fit data from file as the fits can take a long time to run. Then we run our prep function to expose any significant differences in the fits across the algorithms. As an example of the fitting comparison, we print the results for the first ID in the data set (<code>ID = &quot;experienced 2&quot;</code>). This sample shows that the agreement across methods for this set of initial parameter values is rather good for the first participant in the study.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># load data, will be in the variable &#39;fit&#39;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">load</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;valid_fit.Rds&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;fddm&quot;</span>, <span class="dt">mustWork =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb10-3" title="3">fit &lt;-<span class="st"> </span><span class="kw">fit_prep</span>(fit)</a>
<a class="sourceLine" id="cb10-4" title="4"></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">print</span>(<span class="st">&quot;Results for ID = experienced 2&quot;</span>)</a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#&gt; [1] &quot;Results for ID = experienced 2&quot;</span></a>
<a class="sourceLine" id="cb10-7" title="7">fit[(<span class="dv">0</span><span class="op">:</span><span class="dv">5</span>)<span class="op">*</span><span class="dv">11</span><span class="op">+</span><span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co">#&gt;               ID  Algorithm Convergence Objective vu_init vl_init a_init t0_init w_init sv_init</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">#&gt; 1  experienced 2 fs_SWSE_17           0  42.47181       0       0      1  0.2305    0.5       1</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">#&gt; 12 experienced 2  fs_Gon_17           0  42.47181       0       0      1  0.2305    0.5       1</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co">#&gt; 23 experienced 2  fs_Nav_17           0  42.47181       0       0      1  0.2305    0.5       1</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">#&gt; 35 experienced 2  fb_Gon_17           0  42.47181      10     -10      1  0.2305    0.5       1</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co">#&gt; 46 experienced 2  fb_Nav_17           0  42.47181      10     -10      1  0.2305    0.5       1</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co">#&gt; 57 experienced 2    rtdists           0  42.47181      10     -10      1  0.2305    0.5       1</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">#&gt;      vu_fit    vl_fit    a_fit    t0_fit     w_fit   sv_fit     Obj_diff       vu_diff</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt; 1  5.681305 -2.188657 2.790911 0.3764464 0.4010114 2.281295 1.660993e-09  4.213544e-06</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; 12 5.681307 -2.188655 2.790915 0.3764461 0.4010111 2.281291 1.562547e-09  6.397442e-06</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#&gt; 23 5.681299 -2.188660 2.790908 0.3764466 0.4010116 2.281296 1.728765e-09 -1.982117e-06</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co">#&gt; 35 5.681304 -2.188660 2.790912 0.3764464 0.4010115 2.281298 0.000000e+00  0.000000e+00</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="co">#&gt; 46 5.681305 -2.188660 2.790913 0.3764464 0.4010115 2.281299 1.469883e-08  1.119686e-06</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="co">#&gt; 57 5.681305 -2.188660 2.790912 0.3764464 0.4010115 2.281299 1.469822e-08  1.029976e-06</span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="co">#&gt;          vl_diff        a_diff       t0_diff        w_diff       sv_diff</span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">#&gt; 1   8.397604e-07  1.408102e-06 -6.937031e-08 -1.609263e-07 -9.734412e-07</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="co">#&gt; 12  3.374579e-06  5.186847e-06 -3.937648e-07 -3.794396e-07 -5.048216e-06</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="co">#&gt; 23 -2.418119e-06 -1.014296e-06  7.146087e-08  6.097234e-08  2.327210e-07</span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="co">#&gt; 35  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00</span></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="co">#&gt; 46 -3.610748e-07  3.172648e-07  4.550910e-09  1.692955e-09  8.149610e-07</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="co">#&gt; 57 -3.626724e-07  2.295751e-07  3.599953e-09 -7.131966e-09  6.125464e-07</span></a></code></pre></div>
<p>We can see that the fits for this individual participant and this set of initial parameter values are very similar across the different algorithms. As there are many individuals in this dataset, we will not print this style of fit comparison for each combination of participant and initial parameter values; instead we will print only those fits that are worse than the best fit. Output below are all of the runs where either:</p>
<ol style="list-style-type: decimal">
<li><p>the optimization run did not converge (i.e.Convergence = 0); or</p></li>
<li><p>the log-likelihood objective value differs from the smallest produced of any method for that specific set of initial parameter values; or</p></li>
<li><p>or the parameter estimates differ from the smallest produced of any method for that specific set of initial parameter values.</p></li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Define error tolerance</span></a>
<a class="sourceLine" id="cb11-2" title="2">eps &lt;-<span class="st"> </span><span class="fl">1e-4</span></a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4">out &lt;-<span class="st"> </span>fit[<span class="kw">unique</span>(<span class="kw">which</span>(<span class="kw">abs</span>(fit[, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">17</span><span class="op">:</span><span class="dv">23</span>)]) <span class="op">&gt;</span><span class="st"> </span>eps, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>)[, <span class="dv">1</span>]),]</a>
<a class="sourceLine" id="cb11-5" title="5">out[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)] &lt;-<span class="st"> </span><span class="kw">zapsmall</span>(out[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)])</a>
<a class="sourceLine" id="cb11-6" title="6">out</a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt;                   ID  Algorithm Convergence Objective vu_init vl_init a_init t0_init w_init sv_init</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt; 411   experienced 16  fs_Gon_17           1 2966.5346     0.0     0.0    0.5  0.2895    0.5       1</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt; 1588        novice 7 fs_SWSE_17           1 2961.5563     0.0     0.0    0.5  0.2690    0.5       1</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt; 1597        novice 7  fs_Gon_17           1  414.7291    10.0   -10.0    1.0  0.2690    0.5       1</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt; 1599        novice 7  fs_Gon_17           1 2954.4444     0.0     0.0    0.5  0.2690    0.5       1</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt; 2400       novice 19  fs_Nav_17           1  819.4197    10.0   -10.0    1.0  0.2520    0.5       1</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt; 771  inexperienced 8  fb_Nav_17           0  149.9361     0.0     0.0    1.0  0.0885    0.5       1</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co">#&gt; 1465        novice 5  fs_Gon_17           0  133.0414    10.0   -10.0    1.0  0.2815    0.5       1</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="co">#&gt; 1697        novice 8  fb_Nav_17           0   28.7188    -0.5     0.5    1.0  0.0620    0.5       1</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="co">#&gt; 1943       novice 12  fs_Nav_17           0   21.6547     0.0     0.0    1.0  0.3623    0.5       1</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="co">#&gt; 3513       novice 36  fs_Gon_17           0    7.2392     0.0     0.0    0.5  0.2730    0.5       1</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="co">#&gt; 3335       novice 33  fb_Gon_17           0   86.0960    10.0   -10.0    1.0  0.1875    0.5       1</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="co">#&gt;       vu_fit  vl_fit  a_fit t0_fit  w_fit sv_fit  Obj_diff vu_diff vl_diff  a_diff t0_diff  w_diff</span></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="co">#&gt; 411   0.0001 -0.0001 0.4921 0.3045 0.5000 0.9990 2712.8383 -1.2601  1.3891 -2.2641 -0.1647  0.0599</span></a>
<a class="sourceLine" id="cb11-21" title="21"><span class="co">#&gt; 1588  0.0000  0.0000 0.4915 0.2721 0.5001 0.9997 2617.7618 -0.4114  0.9253 -2.4014 -0.1172  0.0864</span></a>
<a class="sourceLine" id="cb11-22" title="22"><span class="co">#&gt; 1597 -0.0703 -0.8049 2.2278 0.2269 0.6624 0.0064   70.9346 -0.4817  0.1205 -0.6652 -0.1625  0.2487</span></a>
<a class="sourceLine" id="cb11-23" title="23"><span class="co">#&gt; 1599  0.0000  0.0000 0.4999 0.2690 0.5000 1.0000 2610.6499 -0.4114  0.9253 -2.3931 -0.1203  0.0863</span></a>
<a class="sourceLine" id="cb11-24" title="24"><span class="co">#&gt; 2400  1.4632 -1.5287 0.7102 0.4944 0.6476 0.6965  664.3276 -0.3301  0.5084 -1.5907  0.0666  0.1377</span></a>
<a class="sourceLine" id="cb11-25" title="25"><span class="co">#&gt; 771   1.8936 -0.0809 2.1561 0.1313 0.4815 0.0000    1.1808 -0.2726 -0.0229 -0.1671  0.0040  0.0081</span></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="co">#&gt; 1465  0.4940 -1.3330 1.5444 0.5027 0.5181 0.0000    3.2519 -0.2709  0.5393 -0.1972  0.0071 -0.0105</span></a>
<a class="sourceLine" id="cb11-27" title="27"><span class="co">#&gt; 1697  1.9776  1.2560 1.4352 0.0995 0.4137 0.0000    5.0284 -0.7610 -0.6282 -0.2765  0.0065  0.0414</span></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="co">#&gt; 1943 -0.7418 -2.6739 1.5598 0.3376 0.5256 0.0000    1.8148  0.3297  0.5947 -0.1746  0.0053 -0.0254</span></a>
<a class="sourceLine" id="cb11-29" title="29"><span class="co">#&gt; 3513  1.5424 -1.9930 1.5396 0.5175 0.4319 0.0000    1.5007 -0.2841  0.3311 -0.1393  0.0026  0.0039</span></a>
<a class="sourceLine" id="cb11-30" title="30"><span class="co">#&gt; 3335  1.7151 -0.1983 1.3949 0.3317 0.4688 1.1782    0.0000  0.0001  0.0000  0.0000  0.0000  0.0000</span></a>
<a class="sourceLine" id="cb11-31" title="31"><span class="co">#&gt;      sv_diff</span></a>
<a class="sourceLine" id="cb11-32" title="32"><span class="co">#&gt; 411  -0.0445</span></a>
<a class="sourceLine" id="cb11-33" title="33"><span class="co">#&gt; 1588  0.3384</span></a>
<a class="sourceLine" id="cb11-34" title="34"><span class="co">#&gt; 1597 -0.6549</span></a>
<a class="sourceLine" id="cb11-35" title="35"><span class="co">#&gt; 1599  0.3387</span></a>
<a class="sourceLine" id="cb11-36" title="36"><span class="co">#&gt; 2400 -1.1265</span></a>
<a class="sourceLine" id="cb11-37" title="37"><span class="co">#&gt; 771  -0.5912</span></a>
<a class="sourceLine" id="cb11-38" title="38"><span class="co">#&gt; 1465 -1.1449</span></a>
<a class="sourceLine" id="cb11-39" title="39"><span class="co">#&gt; 1697 -1.3573</span></a>
<a class="sourceLine" id="cb11-40" title="40"><span class="co">#&gt; 1943 -1.0363</span></a>
<a class="sourceLine" id="cb11-41" title="41"><span class="co">#&gt; 3513 -0.8562</span></a>
<a class="sourceLine" id="cb11-42" title="42"><span class="co">#&gt; 3335  0.0001</span></a></code></pre></div>
<p>We can see that it is mostly the small time methods that have occasional issues with data fitting. Although there are two methods that appear in the above output that use both the small-time and large-time approximations, the method that combines the large-time approximation of Navarro with the small-time approximation of Gondan is actually quite stable. Using this method, there are two offending fitted parameters whose difference from the fits given using <code>rtdists</code> are not smaller than our given error tolerance; in this case, the differences are only marginally greater than our given error tolerance. These results suggest that the most stable methods are those that use both the small-time and large-time approximations to the density, and in particular the default option for <code>dfddm</code> (<code>scale = &quot;both&quot;, n_terms_small = &quot;Gondan&quot;</code>) is very stable .</p>
</div>
<div id="fit-ke" class="section level2">
<h2>Known Errors</h2>
<ol start="5" style="list-style-type: decimal">
<li>If the starting parameter value for <span class="math inline">\(a \leq 0.75\)</span> then the optimization that uses Navarro small-time density approximation yields inaccurate parameter estimates for all of the fitted parameters, yet <code>nlminb</code> claims to have converged. This is likely due to the small value of <span class="math inline">\(a\)</span> creating a larger effective response time <span class="math inline">\(\frac{rt}{a^2}\)</span>, which the small-time approximation may not handle well and thus cause the optimizer to get stuck. This issue does not appear for the density function that uses both the Navarro small-time and large-time approximations (<code>n_terms_small = &quot;Navarro&quot;, scale = &quot;both&quot;</code>) because the large-time approximation will handle this region of the parameter space and produce more accurate results.</li>
</ol>
</div>
</div>
</div>
<div id="section" class="section level1 unlisted unnumbered">
<h1></h1>
<div id="r-session-info" class="section level4 unlisted unnumbered">
<h4>R Session Info</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">sessionInfo</span>()</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; R version 4.0.2 (2020-06-22)</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt; Running under: Windows 10 x64 (build 18363)</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; Matrix products: default</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; locale:</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; [1] LC_COLLATE=C                            LC_CTYPE=English_United Kingdom.1252   </span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; [3] LC_MONETARY=English_United Kingdom.1252 LC_NUMERIC=C                           </span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; [5] LC_TIME=English_United Kingdom.1252    </span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; attached base packages:</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt; other attached packages:</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; [1] testthat_2.3.2       ggplot2_3.3.2.9000   reshape2_1.4.4       microbenchmark_1.4-7</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&gt; [5] RWiener_1.3-3        rtdists_0.11-2       fddm_0.1-1          </span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="co">#&gt; loaded via a namespace (and not attached):</span></a>
<a class="sourceLine" id="cb12-21" title="21"><span class="co">#&gt;  [1] Rcpp_1.0.4.6     pillar_1.4.4     compiler_4.0.2   plyr_1.8.6       tools_4.0.2     </span></a>
<a class="sourceLine" id="cb12-22" title="22"><span class="co">#&gt;  [6] digest_0.6.25    evd_2.3-3        evaluate_0.14    lifecycle_0.2.0  tibble_3.0.1    </span></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="co">#&gt; [11] gtable_0.3.0     lattice_0.20-41  pkgconfig_2.0.3  rlang_0.4.6      Matrix_1.2-18   </span></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="co">#&gt; [16] yaml_2.2.1       mvtnorm_1.1-1    expm_0.999-4     xfun_0.15        withr_2.2.0     </span></a>
<a class="sourceLine" id="cb12-25" title="25"><span class="co">#&gt; [21] dplyr_1.0.0      stringr_1.4.0    knitr_1.29       generics_0.0.2   vctrs_0.3.1     </span></a>
<a class="sourceLine" id="cb12-26" title="26"><span class="co">#&gt; [26] tidyselect_1.1.0 grid_4.0.2       ggnewscale_0.4.1 glue_1.4.1       R6_2.4.1        </span></a>
<a class="sourceLine" id="cb12-27" title="27"><span class="co">#&gt; [31] survival_3.2-3   rmarkdown_2.3    farver_2.0.3     purrr_0.3.4      magrittr_1.5    </span></a>
<a class="sourceLine" id="cb12-28" title="28"><span class="co">#&gt; [36] scales_1.1.1     htmltools_0.5.0  ellipsis_0.3.1   splines_4.0.2    colorspace_1.4-1</span></a>
<a class="sourceLine" id="cb12-29" title="29"><span class="co">#&gt; [41] labeling_0.3     stringi_1.4.6    gsl_2.1-6        munsell_0.5.0    msm_1.6.8       </span></a>
<a class="sourceLine" id="cb12-30" title="30"><span class="co">#&gt; [46] crayon_1.3.4</span></a></code></pre></div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-gondan2014even">
<p>Gondan, Matthias, Steven P Blurton, and Miriam Kesselmeier. 2014. Even Faster and Even More Accurate First-Passage Time Densities and Distributions for the Wiener Diffusion Model. <em>Journal of Mathematical Psychology</em> 60: 2022.</p>
</div>
<div id="ref-trueblood_impact_2018">
<p>Trueblood, Jennifer S., William R. Holmes, Adam C. Seegmiller, Jonathan Douds, Margaret Compton, Eszter Szentirmai, Megan Woodruff, Wenrui Huang, Charles Stratton, and Quentin Eichbaum. 2018. The Impact of Speed and Bias on the Cognitive Processes of Experts and Novices in Medical Image Decision-Making. <em>Cognitive Research: Principles and Implications</em> 3 (1): 28. <a href="https://doi.org/10.1186/s41235-018-0119-2">https://doi.org/10.1186/s41235-018-0119-2</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
